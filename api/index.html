
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-6.2.8">
    
    
      
        <title>modules - Gaussian-Dirichlet Random Fields</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.cb6bc1d0.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.39b8e14a.min.css">
        
          
          
          <meta name="theme-color" content="#02a6f2">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="light-blue" data-md-color-accent="">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#gdrf" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="Gaussian-Dirichlet Random Fields" class="md-header-nav__button md-logo" aria-label="Gaussian-Dirichlet Random Fields">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      <div class="md-header-nav__ellipsis">
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            Gaussian-Dirichlet Random Fields
          </span>
        </div>
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            
              modules
            
          </span>
        </div>
      </div>
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/san-soucie/gdrf/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    gdrf
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href=".." class="md-tabs__link">
      home
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../installation/" class="md-tabs__link">
      installation
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../usage/" class="md-tabs__link">
      usage
    </a>
  </li>

      
        
  
  
    
  


  <li class="md-tabs__item">
    <a href="./" class="md-tabs__link md-tabs__link--active">
      modules
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../contributing/" class="md-tabs__link">
      contributing
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../authors/" class="md-tabs__link">
      authors
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../history/" class="md-tabs__link">
      history
    </a>
  </li>

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Gaussian-Dirichlet Random Fields" class="md-nav__button md-logo" aria-label="Gaussian-Dirichlet Random Fields">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Gaussian-Dirichlet Random Fields
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/san-soucie/gdrf/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    gdrf
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        installation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../usage/" class="md-nav__link">
        usage
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          modules
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        modules
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#gdrf" class="md-nav__link">
    gdrf
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gdrf.cli" class="md-nav__link">
    cli
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gdrf.infer" class="md-nav__link">
    infer
  </a>
  
    <nav class="md-nav" aria-label="infer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gdrf.infer.divergence" class="md-nav__link">
    divergence
  </a>
  
    <nav class="md-nav" aria-label="divergence">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gdrf.infer.divergence.NonlinearExpectationDivergence" class="md-nav__link">
    NonlinearExpectationDivergence
  </a>
  
    <nav class="md-nav" aria-label="NonlinearExpectationDivergence">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gdrf.infer.divergence.NonlinearExpectationDivergence.loss" class="md-nav__link">
    loss()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gdrf.infer.divergence.NonlinearExpectationDivergence.loss_and_grads" class="md-nav__link">
    loss_and_grads()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gdrf.infer.loss" class="md-nav__link">
    loss
  </a>
  
    <nav class="md-nav" aria-label="loss">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gdrf.infer.loss.Loss" class="md-nav__link">
    Loss
  </a>
  
    <nav class="md-nav" aria-label="Loss">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gdrf.infer.loss.Loss.loss" class="md-nav__link">
    loss()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gdrf.infer.loss.Loss.loss_and_grads" class="md-nav__link">
    loss_and_grads()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gdrf.models" class="md-nav__link">
    models
  </a>
  
    <nav class="md-nav" aria-label="models">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gdrf.models.gdrf" class="md-nav__link">
    gdrf
  </a>
  
    <nav class="md-nav" aria-label="gdrf">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gdrf.models.gdrf.GDRF" class="md-nav__link">
    GDRF
  </a>
  
    <nav class="md-nav" aria-label="GDRF">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gdrf.models.gdrf.GDRF.forward" class="md-nav__link">
    forward()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gdrf.models.sparse_gdrf" class="md-nav__link">
    sparse_gdrf
  </a>
  
    <nav class="md-nav" aria-label="sparse_gdrf">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gdrf.models.sparse_gdrf.SparseGDRF" class="md-nav__link">
    SparseGDRF
  </a>
  
    <nav class="md-nav" aria-label="SparseGDRF">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gdrf.models.sparse_gdrf.SparseGDRF.forward" class="md-nav__link">
    forward()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gdrf.models.topic_model" class="md-nav__link">
    topic_model
  </a>
  
    <nav class="md-nav" aria-label="topic_model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gdrf.models.topic_model.CategoricalModel" class="md-nav__link">
    CategoricalModel
  </a>
  
    <nav class="md-nav" aria-label="CategoricalModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gdrf.models.topic_model.CategoricalModel.forward" class="md-nav__link">
    forward()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gdrf.models.topic_model.SpatioTemporalTopicModel" class="md-nav__link">
    SpatioTemporalTopicModel
  </a>
  
    <nav class="md-nav" aria-label="SpatioTemporalTopicModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gdrf.models.topic_model.SpatioTemporalTopicModel.forward" class="md-nav__link">
    forward()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gdrf.models.utils" class="md-nav__link">
    utils
  </a>
  
    <nav class="md-nav" aria-label="utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gdrf.models.utils.generate_data_2d_circles" class="md-nav__link">
    generate_data_2d_circles()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gdrf.models.utils.generate_data_2d_uniform" class="md-nav__link">
    generate_data_2d_uniform()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gdrf.train" class="md-nav__link">
    train
  </a>
  
    <nav class="md-nav" aria-label="train">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gdrf.train.train" class="md-nav__link">
    train()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gdrf.utils" class="md-nav__link">
    utils
  </a>
  
    <nav class="md-nav" aria-label="utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gdrf.utils.callbacks" class="md-nav__link">
    callbacks
  </a>
  
    <nav class="md-nav" aria-label="callbacks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gdrf.utils.callbacks.Callbacks" class="md-nav__link">
    Callbacks
  </a>
  
    <nav class="md-nav" aria-label="Callbacks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gdrf.utils.callbacks.Callbacks.get_registered_actions" class="md-nav__link">
    get_registered_actions()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gdrf.utils.callbacks.Callbacks.register_action" class="md-nav__link">
    register_action()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gdrf.utils.callbacks.Callbacks.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gdrf.utils.general" class="md-nav__link">
    general
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gdrf.utils.loggers" class="md-nav__link">
    loggers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gdrf.utils.wandblogger" class="md-nav__link">
    wandblogger
  </a>
  
    <nav class="md-nav" aria-label="wandblogger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gdrf.utils.wandblogger.WandbLogger" class="md-nav__link">
    WandbLogger
  </a>
  
    <nav class="md-nav" aria-label="WandbLogger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gdrf.utils.wandblogger.WandbLogger.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gdrf.utils.wandblogger.WandbLogger.check_and_upload_dataset" class="md-nav__link">
    check_and_upload_dataset()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gdrf.utils.wandblogger.WandbLogger.create_dataset_table" class="md-nav__link">
    create_dataset_table()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gdrf.utils.wandblogger.WandbLogger.download_dataset_artifact" class="md-nav__link">
    download_dataset_artifact()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gdrf.utils.wandblogger.WandbLogger.download_model_artifact" class="md-nav__link">
    download_model_artifact()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gdrf.utils.wandblogger.WandbLogger.end_epoch" class="md-nav__link">
    end_epoch()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gdrf.utils.wandblogger.WandbLogger.finish_run" class="md-nav__link">
    finish_run()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gdrf.utils.wandblogger.WandbLogger.log" class="md-nav__link">
    log()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gdrf.utils.wandblogger.WandbLogger.log_dataset_artifact" class="md-nav__link">
    log_dataset_artifact()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gdrf.utils.wandblogger.WandbLogger.log_model" class="md-nav__link">
    log_model()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gdrf.utils.wandblogger.WandbLogger.setup_training" class="md-nav__link">
    setup_training()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gdrf.utils.wandblogger.all_logging_disabled" class="md-nav__link">
    all_logging_disabled()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gdrf.visualize" class="md-nav__link">
    visualize
  </a>
  
    <nav class="md-nav" aria-label="visualize">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gdrf.visualize.matrixplot_cli" class="md-nav__link">
    matrixplot_cli()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gdrf.visualize.maxplot_2d_cli" class="md-nav__link">
    maxplot_2d_cli()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gdrf.visualize.stackplot_1d_cli" class="md-nav__link">
    stackplot_1d_cli()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../contributing/" class="md-nav__link">
        contributing
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../authors/" class="md-nav__link">
        authors
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../history/" class="md-nav__link">
        history
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#gdrf" class="md-nav__link">
    gdrf
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gdrf.cli" class="md-nav__link">
    cli
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gdrf.infer" class="md-nav__link">
    infer
  </a>
  
    <nav class="md-nav" aria-label="infer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gdrf.infer.divergence" class="md-nav__link">
    divergence
  </a>
  
    <nav class="md-nav" aria-label="divergence">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gdrf.infer.divergence.NonlinearExpectationDivergence" class="md-nav__link">
    NonlinearExpectationDivergence
  </a>
  
    <nav class="md-nav" aria-label="NonlinearExpectationDivergence">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gdrf.infer.divergence.NonlinearExpectationDivergence.loss" class="md-nav__link">
    loss()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gdrf.infer.divergence.NonlinearExpectationDivergence.loss_and_grads" class="md-nav__link">
    loss_and_grads()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gdrf.infer.loss" class="md-nav__link">
    loss
  </a>
  
    <nav class="md-nav" aria-label="loss">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gdrf.infer.loss.Loss" class="md-nav__link">
    Loss
  </a>
  
    <nav class="md-nav" aria-label="Loss">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gdrf.infer.loss.Loss.loss" class="md-nav__link">
    loss()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gdrf.infer.loss.Loss.loss_and_grads" class="md-nav__link">
    loss_and_grads()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gdrf.models" class="md-nav__link">
    models
  </a>
  
    <nav class="md-nav" aria-label="models">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gdrf.models.gdrf" class="md-nav__link">
    gdrf
  </a>
  
    <nav class="md-nav" aria-label="gdrf">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gdrf.models.gdrf.GDRF" class="md-nav__link">
    GDRF
  </a>
  
    <nav class="md-nav" aria-label="GDRF">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gdrf.models.gdrf.GDRF.forward" class="md-nav__link">
    forward()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gdrf.models.sparse_gdrf" class="md-nav__link">
    sparse_gdrf
  </a>
  
    <nav class="md-nav" aria-label="sparse_gdrf">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gdrf.models.sparse_gdrf.SparseGDRF" class="md-nav__link">
    SparseGDRF
  </a>
  
    <nav class="md-nav" aria-label="SparseGDRF">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gdrf.models.sparse_gdrf.SparseGDRF.forward" class="md-nav__link">
    forward()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gdrf.models.topic_model" class="md-nav__link">
    topic_model
  </a>
  
    <nav class="md-nav" aria-label="topic_model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gdrf.models.topic_model.CategoricalModel" class="md-nav__link">
    CategoricalModel
  </a>
  
    <nav class="md-nav" aria-label="CategoricalModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gdrf.models.topic_model.CategoricalModel.forward" class="md-nav__link">
    forward()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gdrf.models.topic_model.SpatioTemporalTopicModel" class="md-nav__link">
    SpatioTemporalTopicModel
  </a>
  
    <nav class="md-nav" aria-label="SpatioTemporalTopicModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gdrf.models.topic_model.SpatioTemporalTopicModel.forward" class="md-nav__link">
    forward()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gdrf.models.utils" class="md-nav__link">
    utils
  </a>
  
    <nav class="md-nav" aria-label="utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gdrf.models.utils.generate_data_2d_circles" class="md-nav__link">
    generate_data_2d_circles()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gdrf.models.utils.generate_data_2d_uniform" class="md-nav__link">
    generate_data_2d_uniform()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gdrf.train" class="md-nav__link">
    train
  </a>
  
    <nav class="md-nav" aria-label="train">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gdrf.train.train" class="md-nav__link">
    train()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gdrf.utils" class="md-nav__link">
    utils
  </a>
  
    <nav class="md-nav" aria-label="utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gdrf.utils.callbacks" class="md-nav__link">
    callbacks
  </a>
  
    <nav class="md-nav" aria-label="callbacks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gdrf.utils.callbacks.Callbacks" class="md-nav__link">
    Callbacks
  </a>
  
    <nav class="md-nav" aria-label="Callbacks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gdrf.utils.callbacks.Callbacks.get_registered_actions" class="md-nav__link">
    get_registered_actions()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gdrf.utils.callbacks.Callbacks.register_action" class="md-nav__link">
    register_action()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gdrf.utils.callbacks.Callbacks.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gdrf.utils.general" class="md-nav__link">
    general
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gdrf.utils.loggers" class="md-nav__link">
    loggers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gdrf.utils.wandblogger" class="md-nav__link">
    wandblogger
  </a>
  
    <nav class="md-nav" aria-label="wandblogger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gdrf.utils.wandblogger.WandbLogger" class="md-nav__link">
    WandbLogger
  </a>
  
    <nav class="md-nav" aria-label="WandbLogger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gdrf.utils.wandblogger.WandbLogger.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gdrf.utils.wandblogger.WandbLogger.check_and_upload_dataset" class="md-nav__link">
    check_and_upload_dataset()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gdrf.utils.wandblogger.WandbLogger.create_dataset_table" class="md-nav__link">
    create_dataset_table()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gdrf.utils.wandblogger.WandbLogger.download_dataset_artifact" class="md-nav__link">
    download_dataset_artifact()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gdrf.utils.wandblogger.WandbLogger.download_model_artifact" class="md-nav__link">
    download_model_artifact()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gdrf.utils.wandblogger.WandbLogger.end_epoch" class="md-nav__link">
    end_epoch()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gdrf.utils.wandblogger.WandbLogger.finish_run" class="md-nav__link">
    finish_run()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gdrf.utils.wandblogger.WandbLogger.log" class="md-nav__link">
    log()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gdrf.utils.wandblogger.WandbLogger.log_dataset_artifact" class="md-nav__link">
    log_dataset_artifact()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gdrf.utils.wandblogger.WandbLogger.log_model" class="md-nav__link">
    log_model()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gdrf.utils.wandblogger.WandbLogger.setup_training" class="md-nav__link">
    setup_training()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gdrf.utils.wandblogger.all_logging_disabled" class="md-nav__link">
    all_logging_disabled()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gdrf.visualize" class="md-nav__link">
    visualize
  </a>
  
    <nav class="md-nav" aria-label="visualize">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gdrf.visualize.matrixplot_cli" class="md-nav__link">
    matrixplot_cli()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gdrf.visualize.maxplot_2d_cli" class="md-nav__link">
    maxplot_2d_cli()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gdrf.visualize.stackplot_1d_cli" class="md-nav__link">
    stackplot_1d_cli()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/san-soucie/gdrf/edit/master/docs/api.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  <h1>modules</h1>
                
                <div class="doc doc-object doc-module">

<a id="gdrf"></a>
    <div class="doc doc-contents first">

      <p>Top-level package for Gaussian-Dirichlet Random Fields.</p>



  <div class="doc doc-children">














  <div class="doc doc-object doc-module">



<h2 id="gdrf.cli" class="doc doc-heading">
        <code>cli</code>



<a href="#gdrf.cli" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Console script for gdrf.</p>



  <div class="doc doc-children">















  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="gdrf.infer" class="doc doc-heading">
        <code>infer</code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#gdrf.infer" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">




  <div class="doc doc-children">










  <div class="doc doc-object doc-module">



<h3 id="gdrf.infer.divergence" class="doc doc-heading">
        <code>divergence</code>



<a href="#gdrf.infer.divergence" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">




  <div class="doc doc-children">










  <div class="doc doc-object doc-class">



<h4 id="gdrf.infer.divergence.NonlinearExpectationDivergence" class="doc doc-heading">
        <code>NonlinearExpectationDivergence</code>



<a href="#gdrf.infer.divergence.NonlinearExpectationDivergence" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">





  <div class="doc doc-children">










  <div class="doc doc-object doc-method">



<h5 id="gdrf.infer.divergence.NonlinearExpectationDivergence.loss" class="doc doc-heading">
<code class="highlight language-python"><span class="n">loss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">guide</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#gdrf.infer.divergence.NonlinearExpectationDivergence.loss" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>:returns: returns an estimate of the ELBO
:rtype: float</p>
<p>Evaluates the ELBO with an estimator that uses num_particles many samples/particles.</p>

        <details class="quote">
          <summary>Source code in <code>gdrf/infer/divergence.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">loss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">guide</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :returns: returns an estimate of the ELBO</span>
<span class="sd">    :rtype: float</span>

<span class="sd">    Evaluates the ELBO with an estimator that uses num_particles many samples/particles.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">loss_particles</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">is_vectorized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorize_particles</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_particles</span> <span class="o">&gt;</span> <span class="mi">1</span>

    <span class="c1"># grab a vectorized trace from the generator</span>
    <span class="k">for</span> <span class="n">model_trace</span><span class="p">,</span> <span class="n">guide_trace</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_traces</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">guide</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="n">loss_particle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loss_fn</span><span class="p">(</span><span class="n">model_trace</span><span class="p">,</span> <span class="n">guide_trace</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>

        <span class="n">loss_particles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss_particle</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">is_vectorized</span><span class="p">:</span>
        <span class="n">loss_particles</span> <span class="o">=</span> <span class="n">loss_particles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">loss_particles</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">loss_particles</span><span class="p">)</span>

    <span class="n">loss</span> <span class="o">=</span> <span class="o">-</span><span class="n">loss_particles</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_particles</span>
    <span class="n">warn_if_nan</span><span class="p">(</span><span class="n">loss</span><span class="p">,</span> <span class="s2">&quot;loss&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">loss</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="gdrf.infer.divergence.NonlinearExpectationDivergence.loss_and_grads" class="doc doc-heading">
<code class="highlight language-python"><span class="n">loss_and_grads</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">guide</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#gdrf.infer.divergence.NonlinearExpectationDivergence.loss_and_grads" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>:returns: returns an estimate of the ELBO
:rtype: float</p>
<p>Computes the ELBO as well as the surrogate ELBO that is used to form the gradient estimator.
Performs backward on the latter. Num_particle many samples are used to form the estimators.</p>

        <details class="quote">
          <summary>Source code in <code>gdrf/infer/divergence.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">loss_and_grads</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">guide</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :returns: returns an estimate of the ELBO</span>
<span class="sd">    :rtype: float</span>

<span class="sd">    Computes the ELBO as well as the surrogate ELBO that is used to form the gradient estimator.</span>
<span class="sd">    Performs backward on the latter. Num_particle many samples are used to form the estimators.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">loss_particles</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">surrogate_loss_particles</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">is_vectorized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorize_particles</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_particles</span> <span class="o">&gt;</span> <span class="mi">1</span>
    <span class="n">tensor_holder</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># grab a vectorized trace from the generator</span>
    <span class="k">for</span> <span class="n">model_trace</span><span class="p">,</span> <span class="n">guide_trace</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_traces</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">guide</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="n">surrogate_loss_particle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loss_fn</span><span class="p">(</span>
            <span class="n">model_trace</span><span class="p">,</span> <span class="n">guide_trace</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span>
        <span class="p">)</span>
        <span class="n">loss_particle</span> <span class="o">=</span> <span class="n">surrogate_loss_particle</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">is_identically_zero</span><span class="p">(</span><span class="n">loss_particle</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">tensor_holder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">loss_particle</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">tensor_holder</span><span class="p">)</span>
                <span class="n">surrogate_loss_particle</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">tensor_holder</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># loss_particle is not None</span>
            <span class="k">if</span> <span class="n">tensor_holder</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">tensor_holder</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">loss_particle</span><span class="p">)</span>
                <span class="c1"># change types of previous `loss_particle`s</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">loss_particles</span><span class="p">)):</span>
                    <span class="n">loss_particles</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">tensor_holder</span><span class="p">)</span>
                    <span class="n">surrogate_loss_particles</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">tensor_holder</span><span class="p">)</span>

        <span class="n">loss_particles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss_particle</span><span class="p">)</span>
        <span class="n">surrogate_loss_particles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">surrogate_loss_particle</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">tensor_holder</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.0</span>

    <span class="k">if</span> <span class="n">is_vectorized</span><span class="p">:</span>
        <span class="n">loss_particles</span> <span class="o">=</span> <span class="n">loss_particles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">surrogate_loss_particles</span> <span class="o">=</span> <span class="n">surrogate_loss_particles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">loss_particles</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">loss_particles</span><span class="p">)</span>
        <span class="n">surrogate_loss_particles</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">surrogate_loss_particles</span><span class="p">)</span>

    <span class="n">divergence</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nonlinearity</span><span class="p">(</span>
        <span class="n">loss_particles</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_particles</span>
    <span class="p">)</span>

    <span class="c1"># collect parameters to train from model and guide</span>
    <span class="n">trainable_params</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span>
        <span class="n">site</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;param&quot;</span>
        <span class="k">for</span> <span class="n">trace</span> <span class="ow">in</span> <span class="p">(</span><span class="n">model_trace</span><span class="p">,</span> <span class="n">guide_trace</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">trace</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">trainable_params</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span>
        <span class="n">surrogate_loss_particles</span><span class="p">,</span> <span class="s2">&quot;requires_grad&quot;</span><span class="p">,</span> <span class="kc">False</span>
    <span class="p">):</span>
        <span class="n">surrogate_divergence</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">nonlinearity</span><span class="p">(</span>
            <span class="n">surrogate_loss_particles</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_particles</span>
        <span class="p">)</span>
        <span class="n">surrogate_divergence</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
    <span class="n">loss</span> <span class="o">=</span> <span class="o">-</span><span class="n">divergence</span>
    <span class="n">warn_if_nan</span><span class="p">(</span><span class="n">loss</span><span class="p">,</span> <span class="s2">&quot;loss&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">loss</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>








  </div>

    </div>

  </div>




  <div class="doc doc-object doc-module">



<h3 id="gdrf.infer.loss" class="doc doc-heading">
        <code>loss</code>



<a href="#gdrf.infer.loss" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">




  <div class="doc doc-children">








  <div class="doc doc-object doc-class">



<h4 id="gdrf.infer.loss.Loss" class="doc doc-heading">
        <code>Loss</code>



<a href="#gdrf.infer.loss.Loss" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">





  <div class="doc doc-children">










  <div class="doc doc-object doc-method">



<h5 id="gdrf.infer.loss.Loss.loss" class="doc doc-heading">
<code class="highlight language-python"><span class="n">loss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">guide</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#gdrf.infer.loss.Loss.loss" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>:returns: returns an estimate of the ELBO
:rtype: float</p>
<p>Evaluates the ELBO with an estimator that uses num_particles many samples/particles.</p>

        <details class="quote">
          <summary>Source code in <code>gdrf/infer/loss.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">loss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">guide</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :returns: returns an estimate of the ELBO</span>
<span class="sd">    :rtype: float</span>

<span class="sd">    Evaluates the ELBO with an estimator that uses num_particles many samples/particles.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">loss_particles</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">is_vectorized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorize_particles</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_particles</span> <span class="o">&gt;</span> <span class="mi">1</span>

    <span class="c1"># grab a vectorized trace from the generator</span>
    <span class="k">for</span> <span class="n">model_trace</span><span class="p">,</span> <span class="n">guide_trace</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_traces</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">guide</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="n">loss_particle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loss_fn</span><span class="p">(</span><span class="n">model_trace</span><span class="p">,</span> <span class="n">guide_trace</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>

        <span class="n">loss_particles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss_particle</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">is_vectorized</span><span class="p">:</span>
        <span class="n">loss_particles</span> <span class="o">=</span> <span class="n">loss_particles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">loss_particles</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">loss_particles</span><span class="p">)</span>

    <span class="n">loss</span> <span class="o">=</span> <span class="o">-</span><span class="n">loss_particles</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_particles</span>
    <span class="n">warn_if_nan</span><span class="p">(</span><span class="n">loss</span><span class="p">,</span> <span class="s2">&quot;loss&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">loss</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="gdrf.infer.loss.Loss.loss_and_grads" class="doc doc-heading">
<code class="highlight language-python"><span class="n">loss_and_grads</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">guide</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#gdrf.infer.loss.Loss.loss_and_grads" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>:returns: returns an estimate of the ELBO
:rtype: float</p>
<p>Computes the ELBO as well as the surrogate ELBO that is used to form the gradient estimator.
Performs backward on the latter. Num_particle many samples are used to form the estimators.</p>

        <details class="quote">
          <summary>Source code in <code>gdrf/infer/loss.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">loss_and_grads</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">guide</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :returns: returns an estimate of the ELBO</span>
<span class="sd">    :rtype: float</span>

<span class="sd">    Computes the ELBO as well as the surrogate ELBO that is used to form the gradient estimator.</span>
<span class="sd">    Performs backward on the latter. Num_particle many samples are used to form the estimators.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">loss_particles</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">surrogate_loss_particles</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">is_vectorized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorize_particles</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_particles</span> <span class="o">&gt;</span> <span class="mi">1</span>
    <span class="n">tensor_holder</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># grab a vectorized trace from the generator</span>
    <span class="k">for</span> <span class="n">model_trace</span><span class="p">,</span> <span class="n">guide_trace</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_traces</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">guide</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="n">surrogate_loss_particle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loss_fn</span><span class="p">(</span>
            <span class="n">model_trace</span><span class="p">,</span> <span class="n">guide_trace</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span>
        <span class="p">)</span>
        <span class="n">loss_particle</span> <span class="o">=</span> <span class="n">surrogate_loss_particle</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">is_identically_zero</span><span class="p">(</span><span class="n">loss_particle</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">tensor_holder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">loss_particle</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">tensor_holder</span><span class="p">)</span>
                <span class="n">surrogate_loss_particle</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">tensor_holder</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># loss_particle is not None</span>
            <span class="k">if</span> <span class="n">tensor_holder</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">tensor_holder</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">loss_particle</span><span class="p">)</span>
                <span class="c1"># change types of previous `loss_particle`s</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">loss_particles</span><span class="p">)):</span>
                    <span class="n">loss_particles</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">tensor_holder</span><span class="p">)</span>
                    <span class="n">surrogate_loss_particles</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">tensor_holder</span><span class="p">)</span>

        <span class="n">loss_particles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss_particle</span><span class="p">)</span>
        <span class="n">surrogate_loss_particles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">surrogate_loss_particle</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">tensor_holder</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.0</span>

    <span class="k">if</span> <span class="n">is_vectorized</span><span class="p">:</span>
        <span class="n">loss_particles</span> <span class="o">=</span> <span class="n">loss_particles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">surrogate_loss_particles</span> <span class="o">=</span> <span class="n">surrogate_loss_particles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">loss_particles</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">loss_particles</span><span class="p">)</span>
        <span class="n">surrogate_loss_particles</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">surrogate_loss_particles</span><span class="p">)</span>

    <span class="n">loss_val</span> <span class="o">=</span> <span class="n">loss_particles</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_particles</span>

    <span class="c1"># collect parameters to train from model and guide</span>
    <span class="n">trainable_params</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span>
        <span class="n">site</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;param&quot;</span>
        <span class="k">for</span> <span class="n">trace</span> <span class="ow">in</span> <span class="p">(</span><span class="n">model_trace</span><span class="p">,</span> <span class="n">guide_trace</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">trace</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">trainable_params</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span>
        <span class="n">surrogate_loss_particles</span><span class="p">,</span> <span class="s2">&quot;requires_grad&quot;</span><span class="p">,</span> <span class="kc">False</span>
    <span class="p">):</span>
        <span class="n">surrogate_loss_val</span> <span class="o">=</span> <span class="o">-</span><span class="n">surrogate_loss_particles</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_particles</span>
        <span class="n">surrogate_loss_val</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
    <span class="n">loss</span> <span class="o">=</span> <span class="o">-</span><span class="n">loss_val</span>
    <span class="n">warn_if_nan</span><span class="p">(</span><span class="n">loss</span><span class="p">,</span> <span class="s2">&quot;loss&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">loss</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>







  </div>

    </div>

  </div>




  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="gdrf.models" class="doc doc-heading">
        <code>models</code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#gdrf.models" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">




  <div class="doc doc-children">













  <div class="doc doc-object doc-module">



<h3 id="gdrf.models.gdrf" class="doc doc-heading">
        <code>gdrf</code>



<a href="#gdrf.models.gdrf" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">




  <div class="doc doc-children">







  <div class="doc doc-object doc-class">



<h4 id="gdrf.models.gdrf.GDRF" class="doc doc-heading">
        <code>GDRF</code>



<a href="#gdrf.models.gdrf.GDRF" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">





  <div class="doc doc-children">












  <div class="doc doc-object doc-method">



<h5 id="gdrf.models.gdrf.GDRF.forward" class="doc doc-heading">
<code class="highlight language-python"><span class="n">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Xnew</span><span class="p">,</span> <span class="n">full_cov</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


<a href="#gdrf.models.gdrf.GDRF.forward" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Computes the mean and covariance matrix (or variance) of Gaussian Process
posterior on a test input data :math:<code>X_{new}</code>:</p>
<p>.. math:: p(f^* \mid X_{new}, X, y, k, f_{loc}, f_{scale_tril})
    = \mathcal{N}(loc, cov).</p>
<p>.. note:: Variational parameters <code>f_loc</code>, <code>f_scale_tril</code>, together with
    kernel's parameters have been learned from a training procedure (MCMC or
    SVI).</p>
<p>:param torch.Tensor Xnew: A input data for testing. Note that
    <code>Xnew.shape[1:]</code> must be the same as <code>self.X.shape[1:]</code>.
:param bool full_cov: A flag to decide if we want to predict full covariance
    matrix or just variance.
:returns: loc and covariance matrix (or variance) of :math:<code>p(f^*(X_{new}))</code>
:rtype: tuple(torch.Tensor, torch.Tensor)</p>

        <details class="quote">
          <summary>Source code in <code>gdrf/models/gdrf.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@nn</span><span class="o">.</span><span class="n">pyro_method</span>
<span class="nd">@scale_decorator</span><span class="p">(</span><span class="s2">&quot;Xnew&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Xnew</span><span class="p">,</span> <span class="n">full_cov</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes the mean and covariance matrix (or variance) of Gaussian Process</span>
<span class="sd">    posterior on a test input data :math:`X_{new}`:</span>

<span class="sd">    .. math:: p(f^* \mid X_{new}, X, y, k, f_{loc}, f_{scale\_tril})</span>
<span class="sd">        = \mathcal{N}(loc, cov).</span>

<span class="sd">    .. note:: Variational parameters ``f_loc``, ``f_scale_tril``, together with</span>
<span class="sd">        kernel&#39;s parameters have been learned from a training procedure (MCMC or</span>
<span class="sd">        SVI).</span>

<span class="sd">    :param torch.Tensor Xnew: A input data for testing. Note that</span>
<span class="sd">        ``Xnew.shape[1:]`` must be the same as ``self.X.shape[1:]``.</span>
<span class="sd">    :param bool full_cov: A flag to decide if we want to predict full covariance</span>
<span class="sd">        matrix or just variance.</span>
<span class="sd">    :returns: loc and covariance matrix (or variance) of :math:`p(f^*(X_{new}))`</span>
<span class="sd">    :rtype: tuple(torch.Tensor, torch.Tensor)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_check_Xnew_shape</span><span class="p">(</span><span class="n">Xnew</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_mode</span><span class="p">(</span><span class="s2">&quot;guide&quot;</span><span class="p">)</span>

    <span class="n">loc</span><span class="p">,</span> <span class="n">cov</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">conditional</span><span class="p">(</span>
        <span class="n">Xnew</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xs</span><span class="p">),</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_kernel</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f_loc</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f_scale_tril</span><span class="p">,</span>
        <span class="n">full_cov</span><span class="o">=</span><span class="n">full_cov</span><span class="p">,</span>
        <span class="n">whiten</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_whiten</span><span class="p">,</span>
        <span class="n">jitter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_jitter</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">loc</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mean_function</span><span class="p">(</span><span class="n">Xnew</span><span class="p">),</span> <span class="n">cov</span>
</code></pre></div>
        </details>
    </div>

  </div>








  </div>

    </div>

  </div>








  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="gdrf.models.sparse_gdrf" class="doc doc-heading">
        <code>sparse_gdrf</code>



<a href="#gdrf.models.sparse_gdrf" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">




  <div class="doc doc-children">







  <div class="doc doc-object doc-class">



<h4 id="gdrf.models.sparse_gdrf.SparseGDRF" class="doc doc-heading">
        <code>SparseGDRF</code>



<a href="#gdrf.models.sparse_gdrf.SparseGDRF" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">





  <div class="doc doc-children">












  <div class="doc doc-object doc-method">



<h5 id="gdrf.models.sparse_gdrf.SparseGDRF.forward" class="doc doc-heading">
<code class="highlight language-python"><span class="n">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Xnew</span><span class="p">,</span> <span class="n">full_cov</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


<a href="#gdrf.models.sparse_gdrf.SparseGDRF.forward" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Computes the mean and covariance matrix (or variance) of Gaussian Process
posterior on a test input data :math:<code>X_{new}</code>:</p>
<p>.. math:: p(f^* \mid X_{new}, X, y, k, f_{loc}, f_{scale_tril})
    = \mathcal{N}(loc, cov).</p>
<p>.. note:: Variational parameters <code>f_loc</code>, <code>f_scale_tril</code>, together with
    kernel's parameters have been learned from a training procedure (MCMC or
    SVI).</p>
<p>:param torch.Tensor Xnew: A input data for testing. Note that
    <code>Xnew.shape[1:]</code> must be the same as <code>self.X.shape[1:]</code>.
:param bool full_cov: A flag to decide if we want to predict full covariance
    matrix or just variance.
:returns: loc and covariance matrix (or variance) of :math:<code>p(f^*(X_{new}))</code>
:rtype: tuple(torch.Tensor, torch.Tensor)</p>

        <details class="quote">
          <summary>Source code in <code>gdrf/models/sparse_gdrf.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@scale_decorator</span><span class="p">(</span><span class="s2">&quot;Xnew&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Xnew</span><span class="p">,</span> <span class="n">full_cov</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes the mean and covariance matrix (or variance) of Gaussian Process</span>
<span class="sd">    posterior on a test input data :math:`X_{new}`:</span>

<span class="sd">    .. math:: p(f^* \mid X_{new}, X, y, k, f_{loc}, f_{scale\_tril})</span>
<span class="sd">        = \mathcal{N}(loc, cov).</span>

<span class="sd">    .. note:: Variational parameters ``f_loc``, ``f_scale_tril``, together with</span>
<span class="sd">        kernel&#39;s parameters have been learned from a training procedure (MCMC or</span>
<span class="sd">        SVI).</span>

<span class="sd">    :param torch.Tensor Xnew: A input data for testing. Note that</span>
<span class="sd">        ``Xnew.shape[1:]`` must be the same as ``self.X.shape[1:]``.</span>
<span class="sd">    :param bool full_cov: A flag to decide if we want to predict full covariance</span>
<span class="sd">        matrix or just variance.</span>
<span class="sd">    :returns: loc and covariance matrix (or variance) of :math:`p(f^*(X_{new}))`</span>
<span class="sd">    :rtype: tuple(torch.Tensor, torch.Tensor)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_mode</span><span class="p">(</span><span class="s2">&quot;guide&quot;</span><span class="p">)</span>

    <span class="n">posterior_kernel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kernel</span>
    <span class="n">posterior_u_loc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_loc</span>
    <span class="n">posterior_u_scale_tril</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_scale_tril</span>
    <span class="n">Luu</span> <span class="o">=</span> <span class="n">jittercholesky</span><span class="p">(</span>
        <span class="n">posterior_kernel</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_inducing_points</span><span class="p">))</span><span class="o">.</span><span class="n">contiguous</span><span class="p">(),</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">M</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jitter</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxjitter</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">f_loc</span><span class="p">,</span> <span class="n">f_cov</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">conditional</span><span class="p">(</span>
        <span class="n">Xnew</span><span class="p">,</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_inducing_points</span><span class="p">),</span>
        <span class="n">posterior_kernel</span><span class="p">,</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">posterior_u_loc</span><span class="p">),</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">posterior_u_scale_tril</span><span class="p">),</span>
        <span class="n">Luu</span><span class="p">,</span>
        <span class="n">full_cov</span><span class="o">=</span><span class="n">full_cov</span><span class="p">,</span>
        <span class="n">whiten</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_whiten</span><span class="p">,</span>
        <span class="n">jitter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_jitter</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">f_loc</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mean_function</span><span class="p">(</span><span class="n">Xnew</span><span class="p">),</span> <span class="n">f_cov</span>
</code></pre></div>
        </details>
    </div>

  </div>








  </div>

    </div>

  </div>








  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="gdrf.models.topic_model" class="doc doc-heading">
        <code>topic_model</code>



<a href="#gdrf.models.topic_model" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">




  <div class="doc doc-children">







  <div class="doc doc-object doc-class">



<h4 id="gdrf.models.topic_model.CategoricalModel" class="doc doc-heading">
        <code>CategoricalModel</code>



<a href="#gdrf.models.topic_model.CategoricalModel" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">





  <div class="doc doc-children">











  <div class="doc doc-object doc-method">



<h5 id="gdrf.models.topic_model.CategoricalModel.forward" class="doc doc-heading">
<code class="highlight language-python"><span class="n">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">)</span></code>


<a href="#gdrf.models.topic_model.CategoricalModel.forward" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Defines the computation performed at every call.</p>
<p>Should be overridden by all subclasses.</p>
<p>.. note::
    Although the recipe for forward pass needs to be defined within
    this function, one should call the :class:<code>Module</code> instance afterwards
    instead of this since the former takes care of running the
    registered hooks while the latter silently ignores them.</p>

        <details class="quote">
          <summary>Source code in <code>gdrf/models/topic_model.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_mode</span><span class="p">(</span><span class="s2">&quot;guide&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">word_probs</span><span class="p">(</span><span class="n">indices</span><span class="o">=</span><span class="nb">input</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="gdrf.models.topic_model.SpatioTemporalTopicModel" class="doc doc-heading">
        <code>SpatioTemporalTopicModel</code>



<a href="#gdrf.models.topic_model.SpatioTemporalTopicModel" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">





  <div class="doc doc-children">











  <div class="doc doc-object doc-method">



<h5 id="gdrf.models.topic_model.SpatioTemporalTopicModel.forward" class="doc doc-heading">
<code class="highlight language-python"><span class="n">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">)</span></code>


<a href="#gdrf.models.topic_model.SpatioTemporalTopicModel.forward" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Defines the computation performed at every call.</p>
<p>Should be overridden by all subclasses.</p>
<p>.. note::
    Although the recipe for forward pass needs to be defined within
    this function, one should call the :class:<code>Module</code> instance afterwards
    instead of this since the former takes care of running the
    registered hooks while the latter silently ignores them.</p>

        <details class="quote">
          <summary>Source code in <code>gdrf/models/topic_model.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
    <span class="k">pass</span>
</code></pre></div>
        </details>
    </div>

  </div>







  </div>

    </div>

  </div>









  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="gdrf.models.utils" class="doc doc-heading">
        <code>utils</code>



<a href="#gdrf.models.utils" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">




  <div class="doc doc-children">








  <div class="doc doc-object doc-function">



<h4 id="gdrf.models.utils.generate_data_2d_circles" class="doc doc-heading">
<code class="highlight language-python"><span class="n">generate_data_2d_circles</span><span class="p">(</span><span class="n">K</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">V</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">H</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">eta</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">777</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cpu&#39;</span><span class="p">,</span> <span class="n">permute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">constant_background</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>


<a href="#gdrf.models.utils.generate_data_2d_circles" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>This function generates an artifical 2D dataset with <code>K</code> total topics and <code>V</code> total words.
Over a background topic with a uniform distribution of words, one-topic circles are scattered.
Each non-background topic has a word distribution a la the Girdhar thesis word distributions.
At each pixel, a random number of observations, uniformly distributed between <code>V</code> and <code>10V</code>, is generated.</p>

        <details class="quote">
          <summary>Source code in <code>gdrf/models/utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">generate_data_2d_circles</span><span class="p">(</span>
    <span class="n">K</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">V</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">N</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
    <span class="n">W</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span>
    <span class="n">H</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span>
    <span class="n">R</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
    <span class="n">eta</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
    <span class="n">seed</span><span class="o">=</span><span class="mi">777</span><span class="p">,</span>
    <span class="n">device</span><span class="o">=</span><span class="s2">&quot;cpu&quot;</span><span class="p">,</span>
    <span class="n">permute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">constant_background</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function generates an artifical 2D dataset with `K` total topics and `V` total words.</span>
<span class="sd">    Over a background topic with a uniform distribution of words, one-topic circles are scattered.</span>
<span class="sd">    Each non-background topic has a word distribution a la the Girdhar thesis word distributions.</span>
<span class="sd">    At each pixel, a random number of observations, uniformly distributed between `V` and `10V`, is generated.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">K_obj</span> <span class="o">=</span> <span class="n">K</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">gen</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Generator</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">gen</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">topics</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">W</span><span class="p">,</span> <span class="n">H</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">int</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
    <span class="n">centers_x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">W</span> <span class="o">-</span> <span class="n">R</span><span class="p">,</span> <span class="p">[</span><span class="n">N</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">generator</span><span class="o">=</span><span class="n">gen</span><span class="p">)</span>
    <span class="n">centers_y</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">H</span> <span class="o">-</span> <span class="n">R</span><span class="p">,</span> <span class="p">[</span><span class="n">N</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">generator</span><span class="o">=</span><span class="n">gen</span><span class="p">)</span>
    <span class="n">centers</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">centers_x</span><span class="p">,</span> <span class="n">centers_y</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
    <span class="n">obj_topics</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">K_obj</span><span class="p">,</span> <span class="p">[</span><span class="n">N</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">generator</span><span class="o">=</span><span class="n">gen</span><span class="p">)</span>
    <span class="n">xs</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span>
                <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">W</span><span class="p">)),</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">),</span>
                <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">H</span><span class="p">)),</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">),</span>
        <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">W</span> <span class="o">*</span> <span class="n">H</span><span class="p">),</span>
    <span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="n">counts</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span>
        <span class="n">low</span><span class="o">=</span><span class="n">V</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="n">V</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">W</span> <span class="o">*</span> <span class="n">H</span><span class="p">,),</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">generator</span><span class="o">=</span><span class="n">gen</span>
    <span class="p">)</span>

    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj_topics</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span> <span class="o">&lt;</span> <span class="n">K_obj</span> <span class="ow">and</span> <span class="n">N</span> <span class="o">&gt;=</span> <span class="n">K</span><span class="p">:</span>
        <span class="n">obj_topics</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">K_obj</span><span class="p">,</span> <span class="p">[</span><span class="n">N</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">generator</span><span class="o">=</span><span class="n">gen</span><span class="p">)</span>
    <span class="n">obj_topics</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">K_obj_probs</span> <span class="o">=</span> <span class="n">K_obj</span> <span class="k">if</span> <span class="n">constant_background</span> <span class="k">else</span> <span class="n">K</span>
    <span class="n">p_v_z</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="p">[</span>
                <span class="mi">1</span> <span class="o">+</span> <span class="n">eta</span> <span class="k">if</span> <span class="n">V</span> <span class="o">*</span> <span class="n">k</span> <span class="o">/</span> <span class="n">K_obj_probs</span> <span class="o">&lt;=</span> <span class="n">v</span> <span class="o">&lt;</span> <span class="n">V</span> <span class="o">*</span> <span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">K_obj_probs</span> <span class="k">else</span> <span class="n">eta</span>
                <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">K_obj</span><span class="p">)</span>
        <span class="p">],</span>
        <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">words</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">W</span> <span class="o">*</span> <span class="n">H</span><span class="p">,</span> <span class="n">V</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">int</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
    <span class="n">probs</span> <span class="o">=</span> <span class="n">words</span> <span class="o">*</span> <span class="mf">0.0</span>
    <span class="k">if</span> <span class="n">constant_background</span><span class="p">:</span>
        <span class="n">bg_dist</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([</span><span class="mi">1</span> <span class="o">/</span> <span class="n">V</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">V</span><span class="p">)])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">probs</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">bg_dist</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span>
            <span class="p">[</span><span class="mi">1</span> <span class="o">+</span> <span class="n">eta</span> <span class="k">if</span> <span class="n">V</span> <span class="o">*</span> <span class="p">(</span><span class="n">K</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">K</span> <span class="o">&lt;=</span> <span class="n">v</span> <span class="o">&lt;=</span> <span class="n">V</span> <span class="k">else</span> <span class="n">eta</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">V</span><span class="p">)]</span>
        <span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">probs</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
    <span class="n">p_v_z</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">p_v_z</span><span class="p">,</span> <span class="n">bg_dist</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">p_v_z</span> <span class="o">/=</span> <span class="n">p_v_z</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># p_v_z.shape = (K, V)]</span>
    <span class="k">if</span> <span class="n">permute</span><span class="p">:</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randperm</span><span class="p">(</span><span class="n">p_v_z</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">p_v_z</span> <span class="o">=</span> <span class="n">p_v_z</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">p_v_z</span><span class="o">.</span><span class="n">size</span><span class="p">())</span>
    <span class="n">probs</span> <span class="o">=</span> <span class="n">probs</span> <span class="o">+</span> <span class="n">p_v_z</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>

    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">W</span> <span class="o">*</span> <span class="n">H</span><span class="p">):</span>
        <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">xs</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="p">:]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">centers</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">diff</span> <span class="o">=</span> <span class="n">xs</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">centers</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">diff</span> <span class="o">*</span> <span class="n">diff</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">R</span> <span class="o">*</span> <span class="n">R</span><span class="p">:</span>
                <span class="n">topics</span><span class="p">[</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj_topics</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">probs</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">p_v_z</span><span class="p">[</span><span class="n">obj_topics</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
                <span class="k">break</span>
    <span class="n">words</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">W</span> <span class="o">*</span> <span class="n">H</span><span class="p">,</span> <span class="n">V</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">int</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">counts</span><span class="p">)):</span>
        <span class="n">cats</span><span class="p">,</span> <span class="n">obs</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">multinomial</span><span class="p">(</span>
            <span class="nb">input</span><span class="o">=</span><span class="n">probs</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="p">:],</span>
            <span class="n">num_samples</span><span class="o">=</span><span class="n">counts</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span>
            <span class="n">replacement</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">generator</span><span class="o">=</span><span class="n">gen</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">cat</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cats</span><span class="p">):</span>
            <span class="n">words</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">cat</span><span class="p">]</span> <span class="o">=</span> <span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">centers</span><span class="p">,</span> <span class="n">topics</span><span class="p">,</span> <span class="n">p_v_z</span><span class="p">,</span> <span class="n">xs</span><span class="p">,</span> <span class="n">words</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="gdrf.models.utils.generate_data_2d_uniform" class="doc doc-heading">
<code class="highlight language-python"><span class="n">generate_data_2d_uniform</span><span class="p">(</span><span class="n">V</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">H</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">777</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cpu&#39;</span><span class="p">)</span></code>


<a href="#gdrf.models.utils.generate_data_2d_uniform" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>This function generates an artifical 2D dataset with <code>V</code> total words.
Word distributions are completely uniform everywhere.
At each pixel, a random number of observations, uniformly distributed between <code>V</code> and <code>10V</code>, is generated.</p>

        <details class="quote">
          <summary>Source code in <code>gdrf/models/utils.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">generate_data_2d_uniform</span><span class="p">(</span><span class="n">V</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">H</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">777</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s2">&quot;cpu&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function generates an artifical 2D dataset with `V` total words.</span>
<span class="sd">    Word distributions are completely uniform everywhere.</span>
<span class="sd">    At each pixel, a random number of observations, uniformly distributed between `V` and `10V`, is generated.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">gen</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Generator</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">gen</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">xs</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span>
                <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">W</span><span class="p">)),</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">),</span>
                <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">H</span><span class="p">)),</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">),</span>
        <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">W</span> <span class="o">*</span> <span class="n">H</span><span class="p">),</span>
    <span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="n">counts</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span>
        <span class="n">low</span><span class="o">=</span><span class="n">V</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="n">V</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">W</span> <span class="o">*</span> <span class="n">H</span><span class="p">,),</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">generator</span><span class="o">=</span><span class="n">gen</span>
    <span class="p">)</span>
    <span class="n">words</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">W</span> <span class="o">*</span> <span class="n">H</span><span class="p">,</span> <span class="n">V</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">int</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
    <span class="n">probs</span> <span class="o">=</span> <span class="n">words</span> <span class="o">+</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">V</span>
    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">counts</span><span class="p">)):</span>
        <span class="n">cats</span><span class="p">,</span> <span class="n">obs</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">multinomial</span><span class="p">(</span>
            <span class="nb">input</span><span class="o">=</span><span class="n">probs</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="p">:],</span>
            <span class="n">num_samples</span><span class="o">=</span><span class="n">counts</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span>
            <span class="n">replacement</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">generator</span><span class="o">=</span><span class="n">gen</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">cat</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cats</span><span class="p">):</span>
            <span class="n">words</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">cat</span><span class="p">]</span> <span class="o">=</span> <span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">xs</span><span class="p">,</span> <span class="n">words</span>
</code></pre></div>
        </details>
    </div>

  </div>










  </div>

    </div>

  </div>




  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="gdrf.train" class="doc doc-heading">
        <code>train</code>



<a href="#gdrf.train" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Train a GDRF model on a custom dataset</p>
<div class="admonition usage">
<p class="admonition-title">Usage</p>
<p>$ python path/to/train.py --data mvco.csv</p>
</div>



  <div class="doc doc-children">














  <div class="doc doc-object doc-function">



<h3 id="gdrf.train.train" class="doc doc-heading">
<code class="highlight language-python"><span class="n">train</span><span class="p">(</span><span class="n">project</span><span class="o">=</span><span class="s1">&#39;wandb/mvco&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;mvco_adamax_grid&#39;</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cuda:0&#39;</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;data/data.csv&#39;</span><span class="p">,</span> <span class="n">dimensions</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">3000</span><span class="p">,</span> <span class="n">model_type</span><span class="o">=</span><span class="s1">&#39;sparsemultinomialgdrf&#39;</span><span class="p">,</span> <span class="n">num_topics</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dirichlet_param</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">num_inducing_points</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">fixed_inducing_points</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inducing_initialization_method</span><span class="o">=</span><span class="s1">&#39;random&#39;</span><span class="p">,</span> <span class="n">jitter</span><span class="o">=</span><span class="mf">1e-08</span><span class="p">,</span> <span class="n">max_jitter</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">kernel_type</span><span class="o">=</span><span class="s1">&#39;rbf&#39;</span><span class="p">,</span> <span class="n">kernel_lengthscale</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">kernel_variance</span><span class="o">=</span><span class="mf">25.0</span><span class="p">,</span> <span class="n">optimizer_type</span><span class="o">=</span><span class="s1">&#39;adamw&#39;</span><span class="p">,</span> <span class="n">optimizer_lr</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">objective_type</span><span class="o">=</span><span class="s1">&#39;graphelbo&#39;</span><span class="p">,</span> <span class="n">objective_num_particles</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">objective_renyi_alpha</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">resume</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">nosave</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">entity</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">upload_dataset</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save_period</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">artifact_alias</span><span class="o">=</span><span class="s1">&#39;latest&#39;</span><span class="p">,</span> <span class="n">patience</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>


<a href="#gdrf.train.train" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Trains a GDRF</p>
<p>:param str project: Project name for training run
:param str name: Run name for training run
:param str device: Device to store tensors on during training (e.g. 'cpu' or 'cuda:0')
:param bool exist_ok: Existing project/name ok, do not increment
:param str weights: Weights.pt file, if starting from pretrained weights
:param str data: Data.csv file, with first row as column names and first <code>dimensions</code> columns as indexes
:param int dimensions: Number of non-stationary index dimensions (e.g. a time series is 1D, x-y data are 2D, etc.)
:param int epochs: Number of training epochs
:param str model_type: 'gdrf', 'multinomialgdrf', 'sparsegdrf', or 'sparsemultinomialgdrf'
:param int num_topics: Number of GDRF topics
:param float dirichlet_param: GDRF word-topic dirichlet parameter
:param int num_inducing_points: Number of inducing points for sparse GDRF.
:param bool fixed_inducing_points: Whether or not sparse inducing point locations are learned
:param str inducing_initialization_method: 'random' or 'grid'
:param float jitter: Diagonal jitter initial value for cholesky decomposition of kernel
:param int max_jitter: Number of orders of magnitude to try scaling the diagonal jitter before failure
:param str kernel_type: 'rbf', 'matern32', 'matern52', 'exponential', or 'rationalquadratic'
:param float kernel_lengthscale: Length scale of kernel, from 0 to 1
:param float kernel_variance: Overall scaling (variance) of kernel.
:param str optimizer_type: "adagradrmsprop", "clippedadam", "dctadam", "adadelta", "adagrad", "adam", "adamw", "sparseadam", "adamax", "asgd", "sgd", "rprop", "rmsprop"
:param float optimizer_lr: Learning rate for optimizer
:param str objective_type: 'elbo', 'graphelbo', or 'renyielbo'
:param int objective_num_particles: Number of particles (i.e. latent samples) in ELBO calculations
:param float objective_renyi_alpha: Renyi alpha. Only valid for renyi objective type
:param Union[str,bool] resume: Resume most recent training
:param bool nosave: only save final checkpoint
:param str entity: W&amp;B entity
:param bool upload_dataset: Upload dataset to W&amp;B
:param int save_period: Log model after this many epochs
:param str artifact_alias: version of dataset artifact to be used
:param int patience: EarlyStopping Patience (number of epochs without improvement before early stopping)
:param bool verbose: Verbose</p>

        <details class="quote">
          <summary>Source code in <code>gdrf/train.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">train</span><span class="p">(</span>  <span class="c1"># noqa: C901</span>
    <span class="n">project</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;wandb/mvco&quot;</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;mvco_adamax_grid&quot;</span><span class="p">,</span>
    <span class="n">device</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;cuda:0&quot;</span><span class="p">,</span>
    <span class="n">exist_ok</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">weights</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">data</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;data/data.csv&quot;</span><span class="p">,</span>
    <span class="n">dimensions</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">epochs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3000</span><span class="p">,</span>
    <span class="n">model_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;sparsemultinomialgdrf&quot;</span><span class="p">,</span>
    <span class="n">num_topics</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">dirichlet_param</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
    <span class="n">num_inducing_points</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
    <span class="n">fixed_inducing_points</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">inducing_initialization_method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;random&quot;</span><span class="p">,</span>
    <span class="n">jitter</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-8</span><span class="p">,</span>
    <span class="n">max_jitter</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span>
    <span class="n">kernel_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;rbf&quot;</span><span class="p">,</span>
    <span class="n">kernel_lengthscale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">kernel_variance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">25.0</span><span class="p">,</span>
    <span class="n">optimizer_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;adamw&quot;</span><span class="p">,</span>
    <span class="n">optimizer_lr</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">,</span>
    <span class="n">objective_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;graphelbo&quot;</span><span class="p">,</span>
    <span class="n">objective_num_particles</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">objective_renyi_alpha</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">,</span>
    <span class="n">resume</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">nosave</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">entity</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">upload_dataset</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">save_period</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">artifact_alias</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;latest&quot;</span><span class="p">,</span>
    <span class="n">patience</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
    <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Trains a GDRF</span>

<span class="sd">    :param str project: Project name for training run</span>
<span class="sd">    :param str name: Run name for training run</span>
<span class="sd">    :param str device: Device to store tensors on during training (e.g. &#39;cpu&#39; or &#39;cuda:0&#39;)</span>
<span class="sd">    :param bool exist_ok: Existing project/name ok, do not increment</span>
<span class="sd">    :param str weights: Weights.pt file, if starting from pretrained weights</span>
<span class="sd">    :param str data: Data.csv file, with first row as column names and first ``dimensions`` columns as indexes</span>
<span class="sd">    :param int dimensions: Number of non-stationary index dimensions (e.g. a time series is 1D, x-y data are 2D, etc.)</span>
<span class="sd">    :param int epochs: Number of training epochs</span>
<span class="sd">    :param str model_type: &#39;gdrf&#39;, &#39;multinomialgdrf&#39;, &#39;sparsegdrf&#39;, or &#39;sparsemultinomialgdrf&#39;</span>
<span class="sd">    :param int num_topics: Number of GDRF topics</span>
<span class="sd">    :param float dirichlet_param: GDRF word-topic dirichlet parameter</span>
<span class="sd">    :param int num_inducing_points: Number of inducing points for sparse GDRF.</span>
<span class="sd">    :param bool fixed_inducing_points: Whether or not sparse inducing point locations are learned</span>
<span class="sd">    :param str inducing_initialization_method: &#39;random&#39; or &#39;grid&#39;</span>
<span class="sd">    :param float jitter: Diagonal jitter initial value for cholesky decomposition of kernel</span>
<span class="sd">    :param int max_jitter: Number of orders of magnitude to try scaling the diagonal jitter before failure</span>
<span class="sd">    :param str kernel_type: &#39;rbf&#39;, &#39;matern32&#39;, &#39;matern52&#39;, &#39;exponential&#39;, or &#39;rationalquadratic&#39;</span>
<span class="sd">    :param float kernel_lengthscale: Length scale of kernel, from 0 to 1</span>
<span class="sd">    :param float kernel_variance: Overall scaling (variance) of kernel.</span>
<span class="sd">    :param str optimizer_type: &quot;adagradrmsprop&quot;, &quot;clippedadam&quot;, &quot;dctadam&quot;, &quot;adadelta&quot;, &quot;adagrad&quot;, &quot;adam&quot;, &quot;adamw&quot;, &quot;sparseadam&quot;, &quot;adamax&quot;, &quot;asgd&quot;, &quot;sgd&quot;, &quot;rprop&quot;, &quot;rmsprop&quot;</span>
<span class="sd">    :param float optimizer_lr: Learning rate for optimizer</span>
<span class="sd">    :param str objective_type: &#39;elbo&#39;, &#39;graphelbo&#39;, or &#39;renyielbo&#39;</span>
<span class="sd">    :param int objective_num_particles: Number of particles (i.e. latent samples) in ELBO calculations</span>
<span class="sd">    :param float objective_renyi_alpha: Renyi alpha. Only valid for renyi objective type</span>
<span class="sd">    :param Union[str,bool] resume: Resume most recent training</span>
<span class="sd">    :param bool nosave: only save final checkpoint</span>
<span class="sd">    :param str entity: W&amp;B entity</span>
<span class="sd">    :param bool upload_dataset: Upload dataset to W&amp;B</span>
<span class="sd">    :param int save_period: Log model after this many epochs</span>
<span class="sd">    :param str artifact_alias: version of dataset artifact to be used</span>
<span class="sd">    :param int patience: EarlyStopping Patience (number of epochs without improvement before early stopping)</span>
<span class="sd">    :param bool verbose: Verbose</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">opt</span> <span class="o">=</span> <span class="nb">locals</span><span class="p">()</span>
    <span class="n">callbacks</span> <span class="o">=</span> <span class="n">Callbacks</span><span class="p">()</span>
    <span class="n">save_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">increment_path</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">project</span><span class="p">)</span> <span class="o">/</span> <span class="n">name</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="n">exist_ok</span><span class="p">)))</span>
    <span class="n">data_dict</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">loggers</span> <span class="o">=</span> <span class="n">Loggers</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">LOGGER</span><span class="p">)</span>  <span class="c1"># loggers instance</span>
    <span class="k">if</span> <span class="n">loggers</span><span class="o">.</span><span class="n">wandb</span><span class="p">:</span>
        <span class="n">data_dict</span> <span class="o">=</span> <span class="n">loggers</span><span class="o">.</span><span class="n">wandb</span><span class="o">.</span><span class="n">data_dict</span>
        <span class="n">opt</span> <span class="o">=</span> <span class="n">wandb</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span>
        <span class="p">(</span>
            <span class="n">project</span><span class="p">,</span>
            <span class="n">name</span><span class="p">,</span>
            <span class="n">device</span><span class="p">,</span>
            <span class="n">exist_ok</span><span class="p">,</span>
            <span class="n">weights</span><span class="p">,</span>
            <span class="n">data</span><span class="p">,</span>
            <span class="n">dimensions</span><span class="p">,</span>
            <span class="n">epochs</span><span class="p">,</span>
            <span class="n">num_topics</span><span class="p">,</span>
            <span class="n">dirichlet_param</span><span class="p">,</span>
            <span class="n">num_inducing_points</span><span class="p">,</span>
            <span class="n">fixed_inducing_points</span><span class="p">,</span>
            <span class="n">inducing_initialization_method</span><span class="p">,</span>
            <span class="n">jitter</span><span class="p">,</span>
            <span class="n">max_jitter</span><span class="p">,</span>
            <span class="n">kernel_type</span><span class="p">,</span>
            <span class="n">kernel_lengthscale</span><span class="p">,</span>
            <span class="n">kernel_variance</span><span class="p">,</span>
            <span class="n">optimizer_type</span><span class="p">,</span>
            <span class="n">optimizer_lr</span><span class="p">,</span>
            <span class="n">objective_type</span><span class="p">,</span>
            <span class="n">objective_num_particles</span><span class="p">,</span>
            <span class="n">objective_renyi_alpha</span><span class="p">,</span>
            <span class="n">resume</span><span class="p">,</span>
            <span class="n">nosave</span><span class="p">,</span>
            <span class="n">entity</span><span class="p">,</span>
            <span class="n">upload_dataset</span><span class="p">,</span>
            <span class="n">save_period</span><span class="p">,</span>
            <span class="n">artifact_alias</span><span class="p">,</span>
            <span class="n">patience</span><span class="p">,</span>
            <span class="n">verbose</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">opt</span><span class="o">.</span><span class="n">project</span><span class="p">,</span>
            <span class="n">opt</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">opt</span><span class="o">.</span><span class="n">device</span><span class="p">,</span>
            <span class="n">opt</span><span class="o">.</span><span class="n">exist_ok</span><span class="p">,</span>
            <span class="n">opt</span><span class="o">.</span><span class="n">weights</span><span class="p">,</span>
            <span class="n">opt</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
            <span class="n">opt</span><span class="o">.</span><span class="n">dimensions</span><span class="p">,</span>
            <span class="n">opt</span><span class="o">.</span><span class="n">epochs</span><span class="p">,</span>
            <span class="n">opt</span><span class="o">.</span><span class="n">num_topics</span><span class="p">,</span>
            <span class="n">opt</span><span class="o">.</span><span class="n">dirichlet_param</span><span class="p">,</span>
            <span class="n">opt</span><span class="o">.</span><span class="n">num_inducing_points</span><span class="p">,</span>
            <span class="n">opt</span><span class="o">.</span><span class="n">fixed_inducing_points</span><span class="p">,</span>
            <span class="n">opt</span><span class="o">.</span><span class="n">inducing_initialization_method</span><span class="p">,</span>
            <span class="n">opt</span><span class="o">.</span><span class="n">jitter</span><span class="p">,</span>
            <span class="n">opt</span><span class="o">.</span><span class="n">max_jitter</span><span class="p">,</span>
            <span class="n">opt</span><span class="o">.</span><span class="n">kernel_type</span><span class="p">,</span>
            <span class="n">opt</span><span class="o">.</span><span class="n">kernel_lengthscale</span><span class="p">,</span>
            <span class="n">opt</span><span class="o">.</span><span class="n">kernel_variance</span><span class="p">,</span>
            <span class="n">opt</span><span class="o">.</span><span class="n">optimizer_type</span><span class="p">,</span>
            <span class="n">opt</span><span class="o">.</span><span class="n">optimizer_lr</span><span class="p">,</span>
            <span class="n">opt</span><span class="o">.</span><span class="n">objective_type</span><span class="p">,</span>
            <span class="n">opt</span><span class="o">.</span><span class="n">objective_num_particles</span><span class="p">,</span>
            <span class="n">opt</span><span class="o">.</span><span class="n">objective_renyi_alpha</span><span class="p">,</span>
            <span class="n">opt</span><span class="o">.</span><span class="n">resume</span><span class="p">,</span>
            <span class="n">opt</span><span class="o">.</span><span class="n">nosave</span><span class="p">,</span>
            <span class="n">opt</span><span class="o">.</span><span class="n">entity</span><span class="p">,</span>
            <span class="n">opt</span><span class="o">.</span><span class="n">upload_dataset</span><span class="p">,</span>
            <span class="n">opt</span><span class="o">.</span><span class="n">save_period</span><span class="p">,</span>
            <span class="n">opt</span><span class="o">.</span><span class="n">artifact_alias</span><span class="p">,</span>
            <span class="n">opt</span><span class="o">.</span><span class="n">patience</span><span class="p">,</span>
            <span class="n">opt</span><span class="o">.</span><span class="n">verbose</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Register actions</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">(</span><span class="n">loggers</span><span class="p">):</span>
        <span class="n">callbacks</span><span class="o">.</span><span class="n">register_action</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">loggers</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>

    <span class="n">set_logging</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">colorstr</span><span class="p">(</span><span class="s2">&quot;train: &quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">opt</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
    <span class="n">check_git_status</span><span class="p">()</span>
    <span class="n">check_requirements</span><span class="p">(</span><span class="n">requirements</span><span class="o">=</span><span class="n">FILE</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;requirements.txt&quot;</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="p">[])</span>

    <span class="c1"># Resume</span>
    <span class="k">if</span> <span class="n">resume</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">check_wandb_resume</span><span class="p">(</span><span class="n">resume</span><span class="p">):</span>  <span class="c1"># resume an interrupted run</span>
        <span class="n">ckpt</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">resume</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">resume</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">get_latest_run</span><span class="p">()</span>
        <span class="p">)</span>  <span class="c1"># specified or most recent path</span>
        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">ckpt</span><span class="p">),</span> <span class="s2">&quot;ERROR: --resume checkpoint does not exist&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">ckpt</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;opt.yaml&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">ckpt</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;opt.yaml&quot;</span><span class="p">)</span>
            <span class="n">opt</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>  <span class="c1"># replace</span>
        <span class="n">opt</span><span class="p">[</span><span class="s2">&quot;weights&quot;</span><span class="p">],</span> <span class="n">opt</span><span class="p">[</span><span class="s2">&quot;resume&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ckpt</span><span class="p">,</span> <span class="kc">True</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="n">ckpt</span>
        <span class="n">resume</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Resuming training from </span><span class="si">{</span><span class="n">ckpt</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">check_file</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="n">device</span> <span class="o">=</span> <span class="n">select_device</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

    <span class="n">pretrained</span> <span class="o">=</span> <span class="n">weights</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.pt&quot;</span><span class="p">)</span>

    <span class="c1"># Directories</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">save_dir</span> <span class="o">/</span> <span class="s2">&quot;weights&quot;</span>  <span class="c1"># weights dir</span>
    <span class="n">w</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># make dir</span>
    <span class="n">last</span><span class="p">,</span> <span class="n">best</span> <span class="o">=</span> <span class="n">w</span> <span class="o">/</span> <span class="s2">&quot;last.pt&quot;</span><span class="p">,</span> <span class="n">w</span> <span class="o">/</span> <span class="s2">&quot;best.pt&quot;</span>

    <span class="c1"># Hyperparameters</span>
    <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">colorstr</span><span class="p">(</span><span class="s2">&quot;config: &quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">opt</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>

    <span class="c1"># Save run settings</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">save_dir</span> <span class="o">/</span> <span class="s2">&quot;opt.yaml&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">yaml</span><span class="o">.</span><span class="n">safe_dump</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">data_dict</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Loggers</span>

    <span class="c1"># Config</span>
    <span class="n">cuda</span> <span class="o">=</span> <span class="n">device</span> <span class="o">!=</span> <span class="s2">&quot;cpu&quot;</span>
    <span class="n">init_seeds</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">data_dict</span> <span class="o">=</span> <span class="n">data_dict</span> <span class="ow">or</span> <span class="n">check_dataset</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>  <span class="c1"># check if None</span>
    <span class="n">train_path</span> <span class="o">=</span> <span class="n">data_dict</span><span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">]</span>

    <span class="c1"># Dataset</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
            <span class="n">filepath_or_buffer</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
            <span class="n">index_col</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">dimensions</span><span class="p">)),</span>
            <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">parse_dates</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">index</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">values</span> <span class="k">if</span> <span class="n">dimensions</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">index</span><span class="o">.</span><span class="n">to_list</span><span class="p">())</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">index</span> <span class="o">-</span> <span class="n">index</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="n">dimensions</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">index</span> <span class="o">/</span> <span class="n">index</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="n">dimensions</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">xs</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dimensions</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">xs</span> <span class="o">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ws</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">.</span><span class="n">int</span><span class="p">()</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
    <span class="n">min_xs</span> <span class="o">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">max_xs</span> <span class="o">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">world</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">min_xs</span><span class="p">,</span> <span class="n">max_xs</span><span class="p">))</span>
    <span class="n">num_observation_categories</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

    <span class="c1"># Kernel</span>
    <span class="n">kernel_lengthscale</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">kernel_lengthscale</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
    <span class="n">kernel_variance</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">kernel_variance</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

    <span class="n">kernel</span> <span class="o">=</span> <span class="n">KERNEL_DICT</span><span class="p">[</span><span class="n">kernel_type</span><span class="p">](</span>
        <span class="n">input_dim</span><span class="o">=</span><span class="n">dimensions</span><span class="p">,</span> <span class="n">lengthscale</span><span class="o">=</span><span class="n">kernel_lengthscale</span><span class="p">,</span> <span class="n">variance</span><span class="o">=</span><span class="n">kernel_variance</span>
    <span class="p">)</span>
    <span class="n">kernel</span> <span class="o">=</span> <span class="n">kernel</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

    <span class="c1"># Model</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">GDRF_MODEL_DICT</span><span class="p">[</span><span class="n">model_type</span><span class="p">](</span>
        <span class="n">xs</span><span class="o">=</span><span class="n">xs</span><span class="p">,</span>
        <span class="n">ws</span><span class="o">=</span><span class="n">ws</span><span class="p">,</span>
        <span class="n">world</span><span class="o">=</span><span class="n">world</span><span class="p">,</span>
        <span class="n">kernel</span><span class="o">=</span><span class="n">kernel</span><span class="p">,</span>
        <span class="n">num_observation_categories</span><span class="o">=</span><span class="n">num_observation_categories</span><span class="p">,</span>
        <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span>
        <span class="n">num_topic_categories</span><span class="o">=</span><span class="n">num_topics</span><span class="p">,</span>
        <span class="n">dirichlet_param</span><span class="o">=</span><span class="n">dirichlet_param</span><span class="p">,</span>
        <span class="n">n_points</span><span class="o">=</span><span class="n">num_inducing_points</span><span class="p">,</span>
        <span class="n">fixed_inducing_points</span><span class="o">=</span><span class="n">fixed_inducing_points</span><span class="p">,</span>
        <span class="n">inducing_init</span><span class="o">=</span><span class="n">inducing_initialization_method</span><span class="p">,</span>
        <span class="n">maxjitter</span><span class="o">=</span><span class="n">max_jitter</span><span class="p">,</span>
        <span class="n">jitter</span><span class="o">=</span><span class="n">jitter</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Optimizer</span>

    <span class="n">optimizer</span> <span class="o">=</span> <span class="n">OPTIMIZER_DICT</span><span class="p">[</span><span class="n">optimizer_type</span><span class="p">](</span><span class="n">lr</span><span class="o">=</span><span class="n">optimizer_lr</span><span class="p">)</span>

    <span class="c1"># Variational Objective</span>
    <span class="n">objective_hyperparameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;num_particles&quot;</span><span class="p">:</span> <span class="n">objective_num_particles</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">objective_type</span> <span class="o">==</span> <span class="s2">&quot;renyielbo&quot;</span><span class="p">:</span>
        <span class="n">objective_hyperparameters</span><span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">objective_renyi_alpha</span>
    <span class="n">objective</span> <span class="o">=</span> <span class="n">OBJECTIVE_DICT</span><span class="p">[</span><span class="n">objective_type</span><span class="p">](</span>
        <span class="n">vectorize_particles</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">objective_hyperparameters</span>
    <span class="p">)</span>
    <span class="n">start_epoch</span><span class="p">,</span> <span class="n">best_fitness</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;-inf&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">pretrained</span><span class="p">:</span>
        <span class="n">ckpt</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">map_location</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>  <span class="c1"># load checkpoint</span>
        <span class="n">exclude</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># exclude keys</span>
        <span class="n">csd</span> <span class="o">=</span> <span class="n">ckpt</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">float</span><span class="p">()</span><span class="o">.</span><span class="n">state_dict</span><span class="p">()</span>  <span class="c1"># checkpoint state_dict as FP32</span>
        <span class="n">csd</span> <span class="o">=</span> <span class="n">intersect_dicts</span><span class="p">(</span><span class="n">csd</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">state_dict</span><span class="p">(),</span> <span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">)</span>  <span class="c1"># intersect</span>
        <span class="n">model</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">csd</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># load</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Transferred </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">csd</span><span class="p">)</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">state_dict</span><span class="p">())</span><span class="si">}</span><span class="s2"> items from </span><span class="si">{</span><span class="n">weights</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">ckpt</span><span class="p">[</span><span class="s2">&quot;optimizer&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">optimizer</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="n">ckpt</span><span class="p">[</span><span class="s2">&quot;optimizer&quot;</span><span class="p">])</span>
            <span class="n">best_fitness</span> <span class="o">=</span> <span class="n">ckpt</span><span class="p">[</span><span class="s2">&quot;best_fitness&quot;</span><span class="p">]</span>

        <span class="c1"># Epochs</span>
        <span class="n">start_epoch</span> <span class="o">=</span> <span class="n">ckpt</span><span class="p">[</span><span class="s2">&quot;epoch&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">resume</span><span class="p">:</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="n">start_epoch</span> <span class="o">&gt;</span> <span class="mi">0</span>
            <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">weights</span><span class="si">}</span><span class="s2"> training to </span><span class="si">{</span><span class="n">epochs</span><span class="si">}</span><span class="s2"> epochs is finished, nothing to resume.&quot;</span>
        <span class="k">if</span> <span class="n">epochs</span> <span class="o">&lt;</span> <span class="n">start_epoch</span><span class="p">:</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">weights</span><span class="si">}</span><span class="s2"> has been trained for </span><span class="si">{</span><span class="n">ckpt</span><span class="p">[</span><span class="s1">&#39;epoch&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> epochs. Fine-tuning for </span><span class="si">{</span><span class="n">epochs</span><span class="si">}</span><span class="s2"> more epochs.&quot;</span>
            <span class="p">)</span>
            <span class="n">epochs</span> <span class="o">+=</span> <span class="n">ckpt</span><span class="p">[</span><span class="s2">&quot;epoch&quot;</span><span class="p">]</span>  <span class="c1"># finetune additional epochs</span>

        <span class="k">del</span> <span class="n">ckpt</span><span class="p">,</span> <span class="n">csd</span>
    <span class="c1"># SVI object</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">poutine</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">xs</span><span class="p">))</span>
    <span class="n">svi</span> <span class="o">=</span> <span class="n">pyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">SVI</span><span class="p">(</span>
        <span class="n">model</span><span class="o">=</span><span class="n">scale</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model</span><span class="p">),</span>
        <span class="n">guide</span><span class="o">=</span><span class="n">scale</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">guide</span><span class="p">),</span>
        <span class="n">optim</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
        <span class="n">loss</span><span class="o">=</span><span class="n">objective</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">colorstr</span><span class="p">(</span><span class="s1">&#39;model:&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">model</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">colorstr</span><span class="p">(</span><span class="s1">&#39;optimizer:&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">optimizer</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">colorstr</span><span class="p">(</span><span class="s1">&#39;objective:&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">objective</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># Resume</span>

    <span class="n">callbacks</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;on_pretrain_routine_end&quot;</span><span class="p">)</span>

    <span class="c1"># Model parameters</span>

    <span class="c1"># Start training</span>
    <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">stopper</span> <span class="o">=</span> <span class="n">EarlyStopping</span><span class="p">(</span><span class="n">best_fitness</span><span class="o">=</span><span class="n">best_fitness</span><span class="p">,</span> <span class="n">patience</span><span class="o">=</span><span class="n">patience</span><span class="p">)</span>
    <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Logging results to </span><span class="si">{</span><span class="n">colorstr</span><span class="p">(</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">save_dir</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;Starting training for </span><span class="si">{</span><span class="n">epochs</span><span class="si">}</span><span class="s2"> epochs...&quot;</span>
    <span class="p">)</span>
    <span class="k">with</span> <span class="n">logging_redirect_tqdm</span><span class="p">():</span>
        <span class="n">pbar</span> <span class="o">=</span> <span class="n">trange</span><span class="p">(</span><span class="n">start_epoch</span><span class="p">,</span> <span class="n">epochs</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="n">start_epoch</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="n">epochs</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span>
            <span class="n">epoch</span>
        <span class="p">)</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="n">pbar</span>
        <span class="p">):</span>  <span class="c1"># epoch ------------------------------------------------------------------</span>
            <span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>

            <span class="n">loss</span> <span class="o">=</span> <span class="n">svi</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ws</span><span class="p">,</span> <span class="n">subsample</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
            <span class="n">perplexity</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">perplexity</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ws</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>

            <span class="n">pbar</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Epoch </span><span class="si">{</span><span class="n">epoch</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">pbar</span><span class="o">.</span><span class="n">set_postfix</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="n">loss</span><span class="p">,</span> <span class="n">perplexity</span><span class="o">=</span><span class="n">perplexity</span><span class="p">)</span>
            <span class="n">callbacks</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;on_train_epoch_end&quot;</span><span class="p">,</span> <span class="n">epoch</span><span class="o">=</span><span class="n">epoch</span><span class="p">)</span>
            <span class="n">log_vals</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">loss</span><span class="p">,</span>
                <span class="n">perplexity</span><span class="p">,</span>
                <span class="n">model</span><span class="o">.</span><span class="n">kernel_lengthscale</span><span class="p">,</span>
                <span class="n">model</span><span class="o">.</span><span class="n">kernel_variance</span><span class="p">,</span>
            <span class="p">]</span>
            <span class="n">fi</span> <span class="o">=</span> <span class="o">-</span><span class="n">perplexity</span>
            <span class="k">if</span> <span class="n">fi</span> <span class="o">&gt;</span> <span class="n">best_fitness</span><span class="p">:</span>
                <span class="n">best_fitness</span> <span class="o">=</span> <span class="n">fi</span>
            <span class="n">callbacks</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;on_fit_epoch_end&quot;</span><span class="p">,</span> <span class="n">log_vals</span><span class="p">,</span> <span class="n">epoch</span><span class="p">,</span> <span class="n">best_fitness</span><span class="p">,</span> <span class="n">fi</span><span class="p">)</span>
            <span class="n">final_epoch</span> <span class="o">=</span> <span class="p">(</span><span class="n">epoch</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">epochs</span><span class="p">)</span> <span class="ow">or</span> <span class="n">stopper</span><span class="o">.</span><span class="n">possible_stop</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">nosave</span><span class="p">)</span> <span class="ow">or</span> <span class="n">final_epoch</span><span class="p">:</span>
                <span class="n">ckpt</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;epoch&quot;</span><span class="p">:</span> <span class="n">epoch</span><span class="p">,</span>
                    <span class="s2">&quot;best_fitness&quot;</span><span class="p">:</span> <span class="n">best_fitness</span><span class="p">,</span>
                    <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">model</span><span class="p">)</span><span class="o">.</span><span class="n">half</span><span class="p">(),</span>
                    <span class="s2">&quot;optimizer&quot;</span><span class="p">:</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">get_state</span><span class="p">(),</span>
                    <span class="s2">&quot;wandb_id&quot;</span><span class="p">:</span> <span class="n">loggers</span><span class="o">.</span><span class="n">wandb</span><span class="o">.</span><span class="n">wandb_run</span><span class="o">.</span><span class="n">id</span> <span class="k">if</span> <span class="n">loggers</span><span class="o">.</span><span class="n">wandb</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="n">torch</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">ckpt</span><span class="p">,</span> <span class="n">last</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">best_fitness</span> <span class="o">==</span> <span class="n">fi</span><span class="p">:</span>
                    <span class="n">torch</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">ckpt</span><span class="p">,</span> <span class="n">best</span><span class="p">)</span>
                <span class="k">del</span> <span class="n">ckpt</span>
                <span class="n">callbacks</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
                    <span class="s2">&quot;on_model_save&quot;</span><span class="p">,</span> <span class="n">last</span><span class="p">,</span> <span class="n">epoch</span><span class="p">,</span> <span class="n">final_epoch</span><span class="p">,</span> <span class="n">best_fitness</span><span class="p">,</span> <span class="n">fi</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">stopper</span><span class="p">(</span><span class="n">epoch</span><span class="o">=</span><span class="n">epoch</span> <span class="o">-</span> <span class="n">start_epoch</span><span class="p">,</span> <span class="n">fitness</span><span class="o">=</span><span class="n">fi</span><span class="p">):</span>
                <span class="k">break</span>

            <span class="c1"># end epoch ---------------------------------------------------------------------------------------</span>
    <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">epoch</span> <span class="o">-</span> <span class="n">start_epoch</span> <span class="o">+</span> <span class="mi">1</span><span class="si">}</span><span class="s2"> epochs completed in </span><span class="si">{</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3600</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> hours.&quot;</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">last</span><span class="p">,</span> <span class="n">best</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">strip_optimizer</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>  <span class="c1"># strip optimizers</span>
    <span class="n">callbacks</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
        <span class="s2">&quot;on_train_end&quot;</span><span class="p">,</span> <span class="n">last</span><span class="p">,</span> <span class="n">best</span><span class="p">,</span> <span class="n">xs</span><span class="p">,</span> <span class="n">ws</span><span class="p">,</span> <span class="n">dataset</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">dataset</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">epoch</span>
    <span class="p">)</span>
    <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Results saved to </span><span class="si">{</span><span class="n">colorstr</span><span class="p">(</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">save_dir</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">empty_cache</span><span class="p">()</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="gdrf.utils" class="doc doc-heading">
        <code>utils</code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#gdrf.utils" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">




  <div class="doc doc-children">










  <div class="doc doc-object doc-module">



<h3 id="gdrf.utils.callbacks" class="doc doc-heading">
        <code>callbacks</code>



<a href="#gdrf.utils.callbacks" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">




  <div class="doc doc-children">







  <div class="doc doc-object doc-class">



<h4 id="gdrf.utils.callbacks.Callbacks" class="doc doc-heading">
        <code>Callbacks</code>



<a href="#gdrf.utils.callbacks.Callbacks" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>"
Handles all registered callbacks for model hooks
Adapted from YOLOv5, https://github.com/ultralytics/yolov5/</p>




  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h5 id="gdrf.utils.callbacks.Callbacks.get_registered_actions" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_registered_actions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#gdrf.utils.callbacks.Callbacks.get_registered_actions" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>"
Returns all the registered actions by callback hook</p>

        <details class="quote">
          <summary>Source code in <code>gdrf/utils/callbacks.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_registered_actions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; &quot;</span>
<span class="sd">    Returns all the registered actions by callback hook</span>
<span class="sd">    Args:</span>
<span class="sd">        hook The name of the hook to check, defaults to all</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">hook</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callbacks</span><span class="p">[</span><span class="n">hook</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callbacks</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="gdrf.utils.callbacks.Callbacks.register_action" class="doc doc-heading">
<code class="highlight language-python"><span class="n">register_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#gdrf.utils.callbacks.Callbacks.register_action" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Register a new action to a callback hook</p>

        <details class="quote">
          <summary>Source code in <code>gdrf/utils/callbacks.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">register_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Register a new action to a callback hook</span>
<span class="sd">    Args:</span>
<span class="sd">        hook        The callback hook name to register the action to</span>
<span class="sd">        name        The name of the action for later reference</span>
<span class="sd">        callback    The callback to fire</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="n">hook</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callbacks</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;hook &#39;</span><span class="si">{</span><span class="n">hook</span><span class="si">}</span><span class="s2">&#39; not found in callbacks </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_callbacks</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">assert</span> <span class="n">callable</span><span class="p">(</span><span class="n">callback</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;callback &#39;</span><span class="si">{</span><span class="n">callback</span><span class="si">}</span><span class="s2">&#39; is not callable&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_callbacks</span><span class="p">[</span><span class="n">hook</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;callback&quot;</span><span class="p">:</span> <span class="n">callback</span><span class="p">})</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="gdrf.utils.callbacks.Callbacks.run" class="doc doc-heading">
<code class="highlight language-python"><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#gdrf.utils.callbacks.Callbacks.run" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Loop through the registered actions and fire all callbacks</p>

        <details class="quote">
          <summary>Source code in <code>gdrf/utils/callbacks.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Loop through the registered actions and fire all callbacks</span>
<span class="sd">    Args:</span>
<span class="sd">        hook The name of the hook to check, defaults to all</span>
<span class="sd">        args Arguments to receive from GDRF</span>
<span class="sd">        kwargs Keyword Arguments to receive from gDRF</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">assert</span> <span class="p">(</span>
        <span class="n">hook</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callbacks</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;hook &#39;</span><span class="si">{</span><span class="n">hook</span><span class="si">}</span><span class="s2">&#39; not found in callbacks </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_callbacks</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">for</span> <span class="n">logger</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callbacks</span><span class="p">[</span><span class="n">hook</span><span class="p">]:</span>
        <span class="n">logger</span><span class="p">[</span><span class="s2">&quot;callback&quot;</span><span class="p">](</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>







  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="gdrf.utils.general" class="doc doc-heading">
        <code>general</code>



<a href="#gdrf.utils.general" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>General utils
Adapted from YOLOv5, https://github.com/ultralytics/yolov5/</p>



  <div class="doc doc-children">













































  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="gdrf.utils.loggers" class="doc doc-heading">
        <code>loggers</code>



<a href="#gdrf.utils.loggers" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Logging utils
Adapted from YOLOv5, https://github.com/ultralytics/yolov5/</p>



  <div class="doc doc-children">













  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="gdrf.utils.wandblogger" class="doc doc-heading">
        <code>wandblogger</code>



<a href="#gdrf.utils.wandblogger" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Utilities and tools for tracking runs with Weights &amp; Biases.
Adapted from YOLOv5, https://github.com/ultralytics/yolov5/</p>



  <div class="doc doc-children">









  <div class="doc doc-object doc-class">



<h4 id="gdrf.utils.wandblogger.WandbLogger" class="doc doc-heading">
        <code>WandbLogger</code>



<a href="#gdrf.utils.wandblogger.WandbLogger" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Log training runs, datasets, models, and predictions to Weights &amp; Biases.
This logger sends information to W&amp;B at wandb.ai. By default, this information
includes hyperparameters, system configuration and metrics, model metrics,
and basic data metrics and analyses.
By providing additional command line arguments to train.py, datasets,
models and predictions can also be logged.
For more on how this logger is used, see the Weights &amp; Biases documentation:
https://docs.wandb.com/guides/integrations/yolov5</p>




  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h5 id="gdrf.utils.wandblogger.WandbLogger.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">opt_transforms</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">run_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">job_type</span><span class="o">=</span><span class="s1">&#39;Training&#39;</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#gdrf.utils.wandblogger.WandbLogger.__init__" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <ul>
<li>Initialize WandbLogger instance</li>
<li>Upload dataset if opt.upload_dataset is True</li>
<li>Setup trainig processes if job_type is 'Training'</li>
</ul>
      <p>opt (namespace) -- Commandline arguments for this run
opt_transforms (dict) -- Dictionary of transforms to apply when parsing config
run_id (str) -- Run ID of W&amp;B run to be resumed
job_type (str) -- To set the job_type for this run</p>

        <details class="quote">
          <summary>Source code in <code>gdrf/utils/wandblogger.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">opt_transforms</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">run_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">job_type</span><span class="o">=</span><span class="s2">&quot;Training&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    - Initialize WandbLogger instance</span>
<span class="sd">    - Upload dataset if opt.upload_dataset is True</span>
<span class="sd">    - Setup trainig processes if job_type is &#39;Training&#39;</span>
<span class="sd">    arguments:</span>
<span class="sd">    opt (namespace) -- Commandline arguments for this run</span>
<span class="sd">    opt_transforms (dict) -- Dictionary of transforms to apply when parsing config</span>
<span class="sd">    run_id (str) -- Run ID of W&amp;B run to be resumed</span>
<span class="sd">    job_type (str) -- To set the job_type for this run</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Pre-training routine --</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">job_type</span> <span class="o">=</span> <span class="n">job_type</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">wandb</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">wandb_run</span> <span class="o">=</span> <span class="n">wandb</span><span class="p">,</span> <span class="kc">None</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">wandb</span> <span class="k">else</span> <span class="n">wandb</span><span class="o">.</span><span class="n">run</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">train_artifact</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">train_artifact_path</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">result_artifact</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">max_imgs_to_log</span> <span class="o">=</span> <span class="mi">16</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">wandb_artifact_data_dict</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data_dict</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">opt_transforms</span> <span class="o">=</span> <span class="n">opt_transforms</span>
    <span class="c1"># It&#39;s more elegant to stick to 1 wandb.init call, but useful config data is overwritten in the WandbLogger&#39;s wandb.init call</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">opt</span><span class="p">[</span><span class="s2">&quot;resume&quot;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>  <span class="c1"># checks resume from artifact</span>
        <span class="k">if</span> <span class="n">opt</span><span class="p">[</span><span class="s2">&quot;resume&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">WANDB_ARTIFACT_PREFIX</span><span class="p">):</span>
            <span class="n">entity</span><span class="p">,</span> <span class="n">project</span><span class="p">,</span> <span class="n">run_id</span><span class="p">,</span> <span class="n">model_artifact_name</span> <span class="o">=</span> <span class="n">get_run_info</span><span class="p">(</span>
                <span class="n">opt</span><span class="p">[</span><span class="s2">&quot;resume&quot;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">model_artifact_name</span> <span class="o">=</span> <span class="n">WANDB_ARTIFACT_PREFIX</span> <span class="o">+</span> <span class="n">model_artifact_name</span>
            <span class="k">assert</span> <span class="n">wandb</span><span class="p">,</span> <span class="s2">&quot;install wandb to resume wandb runs&quot;</span>
            <span class="c1"># Resume wandb-artifact:// runs here| workaround for not overwriting wandb.config</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wandb_run</span> <span class="o">=</span> <span class="n">wandb</span><span class="o">.</span><span class="n">init</span><span class="p">(</span>
                <span class="nb">id</span><span class="o">=</span><span class="n">run_id</span><span class="p">,</span>
                <span class="n">project</span><span class="o">=</span><span class="n">project</span><span class="p">,</span>
                <span class="n">entity</span><span class="o">=</span><span class="n">entity</span><span class="p">,</span>
                <span class="n">resume</span><span class="o">=</span><span class="s2">&quot;allow&quot;</span><span class="p">,</span>
                <span class="n">allow_val_change</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">opt</span><span class="o">.</span><span class="n">resume</span> <span class="o">=</span> <span class="n">model_artifact_name</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">wandb</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wandb_run</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">wandb</span><span class="o">.</span><span class="n">init</span><span class="p">(</span>
                <span class="n">config</span><span class="o">=</span><span class="n">opt</span><span class="p">,</span>
                <span class="n">resume</span><span class="o">=</span><span class="s2">&quot;allow&quot;</span><span class="p">,</span>
                <span class="n">project</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="n">opt</span><span class="p">[</span><span class="s2">&quot;project&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">stem</span><span class="p">,</span>
                <span class="n">entity</span><span class="o">=</span><span class="n">opt</span><span class="p">[</span><span class="s2">&quot;entity&quot;</span><span class="p">],</span>
                <span class="n">name</span><span class="o">=</span><span class="n">opt</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                <span class="n">job_type</span><span class="o">=</span><span class="n">job_type</span><span class="p">,</span>
                <span class="nb">id</span><span class="o">=</span><span class="n">run_id</span><span class="p">,</span>
                <span class="n">allow_val_change</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">wandb</span><span class="o">.</span><span class="n">run</span>
            <span class="k">else</span> <span class="n">wandb</span><span class="o">.</span><span class="n">run</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wandb_run</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_type</span> <span class="o">==</span> <span class="s2">&quot;Training&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">opt</span><span class="p">[</span><span class="s2">&quot;upload_dataset&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">opt</span><span class="p">[</span><span class="s2">&quot;resume&quot;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">wandb_artifact_data_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_and_upload_dataset</span><span class="p">(</span>
                        <span class="n">opt</span>
                    <span class="p">)</span>

            <span class="k">if</span> <span class="n">opt</span><span class="p">[</span><span class="s2">&quot;resume&quot;</span><span class="p">]:</span>
                <span class="c1"># resume from artifact</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">opt</span><span class="p">[</span><span class="s2">&quot;resume&quot;</span><span class="p">],</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">opt</span><span class="p">[</span><span class="s2">&quot;resume&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span>
                    <span class="n">WANDB_ARTIFACT_PREFIX</span>
                <span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wandb_run</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">data_dict</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># local resume</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data_dict</span> <span class="o">=</span> <span class="n">check_wandb_dataset</span><span class="p">(</span><span class="n">opt</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_dict</span> <span class="o">=</span> <span class="n">check_wandb_dataset</span><span class="p">(</span><span class="n">opt</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">wandb_artifact_data_dict</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">wandb_artifact_data_dict</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_dict</span>
                <span class="p">)</span>

                <span class="c1"># write data_dict to config. useful for resuming from artifacts. Do this only when not resuming.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">wandb_run</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                    <span class="p">{</span><span class="s2">&quot;data_dict&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">wandb_artifact_data_dict</span><span class="p">},</span>
                    <span class="n">allow_val_change</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setup_training</span><span class="p">(</span><span class="n">opt</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_type</span> <span class="o">==</span> <span class="s2">&quot;Dataset Creation&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_and_upload_dataset</span><span class="p">(</span><span class="n">opt</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="gdrf.utils.wandblogger.WandbLogger.check_and_upload_dataset" class="doc doc-heading">
<code class="highlight language-python"><span class="n">check_and_upload_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span></code>


<a href="#gdrf.utils.wandblogger.WandbLogger.check_and_upload_dataset" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Check if the dataset format is compatible and upload it as W&amp;B artifact</p>
      <p>opt (namespace)-- Commandline arguments for current run</p>
      <p>Updated dataset info dictionary where local dataset paths are replaced by WAND_ARFACT_PREFIX links.</p>

        <details class="quote">
          <summary>Source code in <code>gdrf/utils/wandblogger.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">check_and_upload_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opt</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if the dataset format is compatible and upload it as W&amp;B artifact</span>
<span class="sd">    arguments:</span>
<span class="sd">    opt (namespace)-- Commandline arguments for current run</span>
<span class="sd">    returns:</span>
<span class="sd">    Updated dataset info dictionary where local dataset paths are replaced by WAND_ARFACT_PREFIX links.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">wandb</span><span class="p">,</span> <span class="s2">&quot;Install wandb to upload dataset&quot;</span>
    <span class="n">config_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_dataset_artifact</span><span class="p">(</span><span class="n">opt</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">],</span> <span class="n">Path</span><span class="p">(</span><span class="n">opt</span><span class="p">[</span><span class="s2">&quot;project&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">stem</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Created dataset config file &quot;</span><span class="p">,</span> <span class="n">config_path</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">wandb_data_dict</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wandb_data_dict</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="gdrf.utils.wandblogger.WandbLogger.create_dataset_table" class="doc doc-heading">
<code class="highlight language-python"><span class="n">create_dataset_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;dataset&#39;</span><span class="p">)</span></code>


<a href="#gdrf.utils.wandblogger.WandbLogger.create_dataset_table" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Create and return W&amp;B artifact containing W&amp;B Table of the dataset.</p>
      <p>dataset (pandas.DataFrame) -- Dataframe with columns representing
class_to_id (dict(int, str)) -- hash map that maps class ids to labels
name (str) -- name of the artifact</p>
      <p>dataset artifact to be logged or used</p>

        <details class="quote">
          <summary>Source code in <code>gdrf/utils/wandblogger.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">create_dataset_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;dataset&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create and return W&amp;B artifact containing W&amp;B Table of the dataset.</span>
<span class="sd">    arguments:</span>
<span class="sd">    dataset (pandas.DataFrame) -- Dataframe with columns representing</span>
<span class="sd">    class_to_id (dict(int, str)) -- hash map that maps class ids to labels</span>
<span class="sd">    name (str) -- name of the artifact</span>
<span class="sd">    returns:</span>
<span class="sd">    dataset artifact to be logged or used</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">artifact</span> <span class="o">=</span> <span class="n">wandb</span><span class="o">.</span><span class="n">Artifact</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;dataset&quot;</span><span class="p">)</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">wandb</span><span class="o">.</span><span class="n">Table</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">dataset</span><span class="p">)</span>
    <span class="n">artifact</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">artifact</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="gdrf.utils.wandblogger.WandbLogger.download_dataset_artifact" class="doc doc-heading">
<code class="highlight language-python"><span class="n">download_dataset_artifact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">alias</span><span class="p">)</span></code>


<a href="#gdrf.utils.wandblogger.WandbLogger.download_dataset_artifact" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>download the model checkpoint artifact if the path starts with WANDB_ARTIFACT_PREFIX</p>
      <p>path -- path of the dataset to be used for training
alias (str)-- alias of the artifact to be download/used for training</p>
      <p>(str, wandb.Artifact) -- path of the downladed dataset and it's corresponding artifact object if dataset
is found otherwise returns (None, None)</p>

        <details class="quote">
          <summary>Source code in <code>gdrf/utils/wandblogger.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">download_dataset_artifact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">alias</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    download the model checkpoint artifact if the path starts with WANDB_ARTIFACT_PREFIX</span>
<span class="sd">    arguments:</span>
<span class="sd">    path -- path of the dataset to be used for training</span>
<span class="sd">    alias (str)-- alias of the artifact to be download/used for training</span>
<span class="sd">    returns:</span>
<span class="sd">    (str, wandb.Artifact) -- path of the downladed dataset and it&#39;s corresponding artifact object if dataset</span>
<span class="sd">    is found otherwise returns (None, None)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">WANDB_ARTIFACT_PREFIX</span><span class="p">):</span>
        <span class="n">artifact_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span>
            <span class="n">remove_prefix</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">WANDB_ARTIFACT_PREFIX</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="n">alias</span>
        <span class="p">)</span>
        <span class="n">dataset_artifact</span> <span class="o">=</span> <span class="n">wandb</span><span class="o">.</span><span class="n">use_artifact</span><span class="p">(</span>
            <span class="n">artifact_path</span><span class="o">.</span><span class="n">as_posix</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">dataset_artifact</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">),</span> <span class="s2">&quot;&#39;Error: W&amp;B dataset artifact doesn&#39;t exist&#39;&quot;</span>
        <span class="n">datadir</span> <span class="o">=</span> <span class="n">dataset_artifact</span><span class="o">.</span><span class="n">download</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">datadir</span><span class="p">,</span> <span class="n">dataset_artifact</span>
    <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="gdrf.utils.wandblogger.WandbLogger.download_model_artifact" class="doc doc-heading">
<code class="highlight language-python"><span class="n">download_model_artifact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span></code>


<a href="#gdrf.utils.wandblogger.WandbLogger.download_model_artifact" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>download the model checkpoint artifact if the resume path starts with WANDB_ARTIFACT_PREFIX</p>
      <p>opt (namespace) -- Commandline arguments for this run</p>

        <details class="quote">
          <summary>Source code in <code>gdrf/utils/wandblogger.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">download_model_artifact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opt</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    download the model checkpoint artifact if the resume path starts with WANDB_ARTIFACT_PREFIX</span>
<span class="sd">    arguments:</span>
<span class="sd">    opt (namespace) -- Commandline arguments for this run</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">opt</span><span class="p">[</span><span class="s2">&quot;resume&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">WANDB_ARTIFACT_PREFIX</span><span class="p">):</span>
        <span class="n">model_artifact</span> <span class="o">=</span> <span class="n">wandb</span><span class="o">.</span><span class="n">use_artifact</span><span class="p">(</span>
            <span class="n">remove_prefix</span><span class="p">(</span><span class="n">opt</span><span class="p">[</span><span class="s2">&quot;resume&quot;</span><span class="p">],</span> <span class="n">WANDB_ARTIFACT_PREFIX</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;:latest&quot;</span>
        <span class="p">)</span>
        <span class="k">assert</span> <span class="n">model_artifact</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Error: W&amp;B model artifact doesn&#39;t exist&quot;</span>
        <span class="n">modeldir</span> <span class="o">=</span> <span class="n">model_artifact</span><span class="o">.</span><span class="n">download</span><span class="p">()</span>
        <span class="c1"># epochs_trained = model_artifact.metadata.get(&quot;epochs_trained&quot;)</span>
        <span class="n">total_epochs</span> <span class="o">=</span> <span class="n">model_artifact</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;total_epochs&quot;</span><span class="p">)</span>
        <span class="n">is_finished</span> <span class="o">=</span> <span class="n">total_epochs</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="ow">not</span> <span class="n">is_finished</span>
        <span class="p">),</span> <span class="s2">&quot;training is finished, can only resume incomplete runs.&quot;</span>
        <span class="k">return</span> <span class="n">modeldir</span><span class="p">,</span> <span class="n">model_artifact</span>
    <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="gdrf.utils.wandblogger.WandbLogger.end_epoch" class="doc doc-heading">
<code class="highlight language-python"><span class="n">end_epoch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">best_result</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


<a href="#gdrf.utils.wandblogger.WandbLogger.end_epoch" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>commit the log_dict, model artifacts and Tables to W&amp;B and flush the log_dict.</p>
      <p>best_result (boolean): Boolean representing if the result of this evaluation is best or not</p>

        <details class="quote">
          <summary>Source code in <code>gdrf/utils/wandblogger.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">end_epoch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">best_result</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    commit the log_dict, model artifacts and Tables to W&amp;B and flush the log_dict.</span>
<span class="sd">    arguments:</span>
<span class="sd">    best_result (boolean): Boolean representing if the result of this evaluation is best or not</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wandb_run</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">all_logging_disabled</span><span class="p">():</span>
            <span class="n">wandb</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_dict</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">result_artifact</span><span class="p">:</span>
            <span class="n">wandb</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">result_artifact</span><span class="p">,</span>
                <span class="n">aliases</span><span class="o">=</span><span class="p">[</span>
                    <span class="s2">&quot;latest&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;last&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;epoch &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_epoch</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;best&quot;</span> <span class="k">if</span> <span class="n">best_result</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                <span class="p">],</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">result_artifact</span> <span class="o">=</span> <span class="n">wandb</span><span class="o">.</span><span class="n">Artifact</span><span class="p">(</span>
                <span class="s2">&quot;run_&quot;</span> <span class="o">+</span> <span class="n">wandb</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">id</span> <span class="o">+</span> <span class="s2">&quot;_progress&quot;</span><span class="p">,</span> <span class="s2">&quot;evaluation&quot;</span>
            <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="gdrf.utils.wandblogger.WandbLogger.finish_run" class="doc doc-heading">
<code class="highlight language-python"><span class="n">finish_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#gdrf.utils.wandblogger.WandbLogger.finish_run" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Log metrics if any and finish the current W&amp;B run</p>

        <details class="quote">
          <summary>Source code in <code>gdrf/utils/wandblogger.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">finish_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Log metrics if any and finish the current W&amp;B run</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;artifact_or_path&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;aliases&quot;</span><span class="p">]</span>
    <span class="p">):</span>
        <span class="n">wandb</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span>
            <span class="n">artifact_or_path</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;artifact_or_path&quot;</span><span class="p">),</span>
            <span class="nb">type</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">),</span>
            <span class="n">name</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">),</span>
            <span class="n">aliases</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;aliases&quot;</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wandb_run</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_dict</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">all_logging_disabled</span><span class="p">():</span>
                <span class="n">wandb</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_dict</span><span class="p">)</span>
        <span class="n">wandb</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">finish</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="gdrf.utils.wandblogger.WandbLogger.log" class="doc doc-heading">
<code class="highlight language-python"><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">log_dict</span><span class="p">)</span></code>


<a href="#gdrf.utils.wandblogger.WandbLogger.log" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>save the metrics to the logging dictionary</p>
      <p>log_dict (Dict) -- metrics/media to be logged in current step</p>

        <details class="quote">
          <summary>Source code in <code>gdrf/utils/wandblogger.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">log_dict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    save the metrics to the logging dictionary</span>
<span class="sd">    arguments:</span>
<span class="sd">    log_dict (Dict) -- metrics/media to be logged in current step</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wandb_run</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">log_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="gdrf.utils.wandblogger.WandbLogger.log_dataset_artifact" class="doc doc-heading">
<code class="highlight language-python"><span class="n">log_dataset_artifact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_file</span><span class="p">,</span> <span class="n">project</span><span class="p">,</span> <span class="n">overwrite_config</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


<a href="#gdrf.utils.wandblogger.WandbLogger.log_dataset_artifact" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Log the dataset as W&amp;B artifact and return the new data file with W&amp;B links</p>
      <p>data_file (str) -- the .yaml file with information about the dataset like - path, classes etc.
single_class (boolean)  -- train multi-class data as single-class
project (str) -- project name. Used to construct the artifact path
overwrite_config (boolean) -- overwrites the data.yaml file if set to true otherwise creates a new
file with _wandb postfix. Eg -&gt; data_wandb.yaml</p>
      <p>the new .yaml file with artifact links. it can be used to start training directly from artifacts</p>

        <details class="quote">
          <summary>Source code in <code>gdrf/utils/wandblogger.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">log_dataset_artifact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_file</span><span class="p">,</span> <span class="n">project</span><span class="p">,</span> <span class="n">overwrite_config</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Log the dataset as W&amp;B artifact and return the new data file with W&amp;B links</span>
<span class="sd">    arguments:</span>
<span class="sd">    data_file (str) -- the .yaml file with information about the dataset like - path, classes etc.</span>
<span class="sd">    single_class (boolean)  -- train multi-class data as single-class</span>
<span class="sd">    project (str) -- project name. Used to construct the artifact path</span>
<span class="sd">    overwrite_config (boolean) -- overwrites the data.yaml file if set to true otherwise creates a new</span>
<span class="sd">    file with _wandb postfix. Eg -&gt; data_wandb.yaml</span>
<span class="sd">    returns:</span>
<span class="sd">    the new .yaml file with artifact links. it can be used to start training directly from artifacts</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data_dict</span> <span class="o">=</span> <span class="n">check_dataset</span><span class="p">(</span><span class="n">data_file</span><span class="p">)</span>  <span class="c1"># parse and check</span>
    <span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dict</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">train_artifact</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_dataset_table</span><span class="p">(</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">],</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;train&quot;</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;train&quot;</span><span class="p">)</span>
        <span class="k">else</span> <span class="kc">None</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;train&quot;</span><span class="p">):</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">WANDB_ARTIFACT_PREFIX</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">project</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;train&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;val&quot;</span><span class="p">):</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;val&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">WANDB_ARTIFACT_PREFIX</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">project</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;val&quot;</span><span class="p">)</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">data_file</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span>
    <span class="n">path</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">path</span> <span class="k">if</span> <span class="n">overwrite_config</span> <span class="k">else</span> <span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;_wandb&quot;</span>
    <span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.csv&quot;</span>  <span class="c1"># updated data.yaml path</span>
    <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;download&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;path&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_type</span> <span class="o">==</span> <span class="s2">&quot;Training&quot;</span><span class="p">:</span>  <span class="c1"># builds correct artifact pipeline graph</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wandb_run</span><span class="o">.</span><span class="n">use_artifact</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_artifact</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wandb_run</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_artifact</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">path</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="gdrf.utils.wandblogger.WandbLogger.log_model" class="doc doc-heading">
<code class="highlight language-python"><span class="n">log_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">epoch</span><span class="p">,</span> <span class="n">fitness_score</span><span class="p">,</span> <span class="n">best_model</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


<a href="#gdrf.utils.wandblogger.WandbLogger.log_model" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Log the model checkpoint as W&amp;B artifact</p>
      <p>path (Path)   -- Path of directory containing the checkpoints
opt (namespace) -- Command line arguments for this run
epoch (int)  -- Current epoch number
fitness_score (float) -- fitness score for current epoch
best_model (boolean) -- Boolean representing if the current checkpoint is the best yet.</p>

        <details class="quote">
          <summary>Source code in <code>gdrf/utils/wandblogger.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">log_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">epoch</span><span class="p">,</span> <span class="n">fitness_score</span><span class="p">,</span> <span class="n">best_model</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Log the model checkpoint as W&amp;B artifact</span>
<span class="sd">    arguments:</span>
<span class="sd">    path (Path)   -- Path of directory containing the checkpoints</span>
<span class="sd">    opt (namespace) -- Command line arguments for this run</span>
<span class="sd">    epoch (int)  -- Current epoch number</span>
<span class="sd">    fitness_score (float) -- fitness score for current epoch</span>
<span class="sd">    best_model (boolean) -- Boolean representing if the current checkpoint is the best yet.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">model_artifact</span> <span class="o">=</span> <span class="n">wandb</span><span class="o">.</span><span class="n">Artifact</span><span class="p">(</span>
        <span class="s2">&quot;run_&quot;</span> <span class="o">+</span> <span class="n">wandb</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">id</span> <span class="o">+</span> <span class="s2">&quot;_model&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;model&quot;</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;original_url&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">),</span>
            <span class="s2">&quot;epochs_trained&quot;</span><span class="p">:</span> <span class="n">epoch</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;save period&quot;</span><span class="p">:</span> <span class="n">opt</span><span class="p">[</span><span class="s2">&quot;save_period&quot;</span><span class="p">],</span>
            <span class="s2">&quot;project&quot;</span><span class="p">:</span> <span class="n">opt</span><span class="p">[</span><span class="s2">&quot;project&quot;</span><span class="p">],</span>
            <span class="s2">&quot;total_epochs&quot;</span><span class="p">:</span> <span class="n">opt</span><span class="p">[</span><span class="s2">&quot;epochs&quot;</span><span class="p">],</span>
            <span class="s2">&quot;fitness_score&quot;</span><span class="p">:</span> <span class="n">fitness_score</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">)</span>
    <span class="n">model_artifact</span><span class="o">.</span><span class="n">add_file</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">path</span> <span class="o">/</span> <span class="s2">&quot;last.pt&quot;</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;last.pt&quot;</span><span class="p">)</span>
    <span class="n">wandb</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span>
        <span class="n">model_artifact</span><span class="p">,</span>
        <span class="n">aliases</span><span class="o">=</span><span class="p">[</span>
            <span class="s2">&quot;latest&quot;</span><span class="p">,</span>
            <span class="s2">&quot;last&quot;</span><span class="p">,</span>
            <span class="s2">&quot;epoch &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_epoch</span><span class="p">),</span>
            <span class="s2">&quot;best&quot;</span> <span class="k">if</span> <span class="n">best_model</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving model artifact on epoch &quot;</span><span class="p">,</span> <span class="n">epoch</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="gdrf.utils.wandblogger.WandbLogger.setup_training" class="doc doc-heading">
<code class="highlight language-python"><span class="n">setup_training</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span></code>


<a href="#gdrf.utils.wandblogger.WandbLogger.setup_training" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Setup the necessary processes for training YOLO models:
  - Attempt to download model checkpoint and dataset artifacts if opt.resume stats with WANDB_ARTIFACT_PREFIX
  - Update data_dict, to contain info of previous run if resumed and the paths of dataset artifact if downloaded
  - Setup log_dict, initialize bbox_interval</p>
      <p>opt (namespace) -- commandline arguments for this run</p>

        <details class="quote">
          <summary>Source code in <code>gdrf/utils/wandblogger.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">setup_training</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opt</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Setup the necessary processes for training YOLO models:</span>
<span class="sd">      - Attempt to download model checkpoint and dataset artifacts if opt.resume stats with WANDB_ARTIFACT_PREFIX</span>
<span class="sd">      - Update data_dict, to contain info of previous run if resumed and the paths of dataset artifact if downloaded</span>
<span class="sd">      - Setup log_dict, initialize bbox_interval</span>
<span class="sd">    arguments:</span>
<span class="sd">    opt (namespace) -- commandline arguments for this run</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log_dict</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_epoch</span> <span class="o">=</span> <span class="p">{},</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">opt</span><span class="p">[</span><span class="s2">&quot;resume&quot;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">modeldir</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">download_model_artifact</span><span class="p">(</span><span class="n">opt</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">modeldir</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">modeldir</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;last.pt&quot;</span>
            <span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wandb_run</span><span class="o">.</span><span class="n">config</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">opt</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">opt_transforms</span><span class="p">:</span>
                        <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">opt_transforms</span><span class="p">[</span><span class="n">k</span><span class="p">](</span><span class="n">v</span><span class="p">)</span>
                    <span class="n">opt</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>

    <span class="n">data_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_dict</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">train_artifact_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_artifact</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">download_dataset_artifact</span><span class="p">(</span>
        <span class="n">data_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;train&quot;</span><span class="p">),</span> <span class="n">opt</span><span class="p">[</span><span class="s2">&quot;artifact_alias&quot;</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_artifact_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">data_dict</span><span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_artifact_path</span><span class="p">))</span>

    <span class="n">train_from_artifact</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_artifact_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="c1"># Update the the data_dict to point to local artifacts dir</span>
    <span class="k">if</span> <span class="n">train_from_artifact</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_dict</span> <span class="o">=</span> <span class="n">data_dict</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>




  <div class="doc doc-object doc-function">



<h4 id="gdrf.utils.wandblogger.all_logging_disabled" class="doc doc-heading">
<code class="highlight language-python"><span class="n">all_logging_disabled</span><span class="p">(</span><span class="n">highest_level</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span></code>


<a href="#gdrf.utils.wandblogger.all_logging_disabled" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>source - https://gist.github.com/simon-weber/7853144
A context manager that will prevent any logging messages triggered during the body from being processed.
:param highest_level: the maximum logging level in use.
  This would only need to be changed if a custom level greater than CRITICAL is defined.</p>

        <details class="quote">
          <summary>Source code in <code>gdrf/utils/wandblogger.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">all_logging_disabled</span><span class="p">(</span><span class="n">highest_level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;source - https://gist.github.com/simon-weber/7853144</span>
<span class="sd">    A context manager that will prevent any logging messages triggered during the body from being processed.</span>
<span class="sd">    :param highest_level: the maximum logging level in use.</span>
<span class="sd">      This would only need to be changed if a custom level greater than CRITICAL is defined.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">previous_level</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">disable</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">disable</span><span class="p">(</span><span class="n">highest_level</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">disable</span><span class="p">(</span><span class="n">previous_level</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>










  </div>

    </div>

  </div>




  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="gdrf.visualize" class="doc doc-heading">
        <code>visualize</code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#gdrf.visualize" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">




  <div class="doc doc-children">










  <div class="doc doc-object doc-function">



<h3 id="gdrf.visualize.matrixplot_cli" class="doc doc-heading">
<code class="highlight language-python"><span class="n">matrixplot_cli</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">)</span></code>


<a href="#gdrf.visualize.matrixplot_cli" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Creates a matrix plot from the probabilities in the CSV file <code>data</code>.
The first row of the CSV file should be a header.
The first column of the CSV file should be an index.
All other columns are considered data.
Optionally, the probabilities may be plotted on a log-scale colorbar.</p>
<p>:param str data: A CSV file with probabilities. Header row is required, index column is required.
:param bool log: An optional CSV file with the index. Header row is required.
:param float epsilon: An optional "jitter" parameter, for plotting small probabilities on a log-scale</p>

        <details class="quote">
          <summary>Source code in <code>gdrf/visualize/__init__.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">matrixplot_cli</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">log</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-10</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a matrix plot from the probabilities in the CSV file `data`.</span>
<span class="sd">    The first row of the CSV file should be a header.</span>
<span class="sd">    The first column of the CSV file should be an index.</span>
<span class="sd">    All other columns are considered data.</span>
<span class="sd">    Optionally, the probabilities may be plotted on a log-scale colorbar.</span>

<span class="sd">    :param str data: A CSV file with probabilities. Header row is required, index column is required.</span>
<span class="sd">    :param bool log: An optional CSV file with the index. Header row is required.</span>
<span class="sd">    :param float epsilon: An optional &quot;jitter&quot; parameter, for plotting small probabilities on a log-scale</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">display</span><span class="p">(</span><span class="n">matrix_plot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="n">log</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="n">epsilon</span><span class="p">))</span>
</code></pre></div>
        </details>
    </div>

  </div>




  <div class="doc doc-object doc-function">



<h3 id="gdrf.visualize.maxplot_2d_cli" class="doc doc-heading">
<code class="highlight language-python"><span class="n">maxplot_2d_cli</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#gdrf.visualize.maxplot_2d_cli" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Creates a 2-D maximum plot from the probabilities in the CSV file <code>data</code>.
Optionally, a two-column CSV file <code>index</code> may be provided.
The first row of CSV files should be a header.
All columns are considered data, except if no <code>index</code> CSV is provided the first two columns of <code>data</code> are the index.</p>
<p>:param str data: A CSV file with probabilities. Header row is required, index columns are optional
:param str index: An optional CSV file with the index. Header row is required.</p>

        <details class="quote">
          <summary>Source code in <code>gdrf/visualize/__init__.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">maxplot_2d_cli</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a 2-D maximum plot from the probabilities in the CSV file `data`.</span>
<span class="sd">    Optionally, a two-column CSV file `index` may be provided.</span>
<span class="sd">    The first row of CSV files should be a header.</span>
<span class="sd">    All columns are considered data, except if no `index` CSV is provided the first two columns of `data` are the index.</span>

<span class="sd">    :param str data: A CSV file with probabilities. Header row is required, index columns are optional</span>
<span class="sd">    :param str index: An optional CSV file with the index. Header row is required.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">display</span><span class="p">(</span><span class="n">maxplot_2d</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">index</span><span class="p">))</span>
</code></pre></div>
        </details>
    </div>

  </div>






  <div class="doc doc-object doc-function">



<h3 id="gdrf.visualize.stackplot_1d_cli" class="doc doc-heading">
<code class="highlight language-python"><span class="n">stackplot_1d_cli</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#gdrf.visualize.stackplot_1d_cli" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Creates a 1-D stackplot from the probabilities in the CSV file <code>data</code>.
Optionally, a single-column CSV file <code>index</code> may be provided.
The first row of CSV files should be a header.
All columns are considered data, except if no <code>index</code> CSV is provided the first column of <code>data</code> is the index.</p>
<p>:param str data: A CSV file with probabilities. Header row is required, index column is optional
:param str index: An optional CSV file with the index. Header row is required.</p>

        <details class="quote">
          <summary>Source code in <code>gdrf/visualize/__init__.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">stackplot_1d_cli</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a 1-D stackplot from the probabilities in the CSV file `data`.</span>
<span class="sd">    Optionally, a single-column CSV file `index` may be provided.</span>
<span class="sd">    The first row of CSV files should be a header.</span>
<span class="sd">    All columns are considered data, except if no `index` CSV is provided the first column of `data` is the index.</span>

<span class="sd">    :param str data: A CSV file with probabilities. Header row is required, index column is optional</span>
<span class="sd">    :param str index: An optional CSV file with the index. Header row is required.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">display</span><span class="p">(</span><span class="n">stackplot_1d</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">index</span><span class="p">))</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>




  </div>

    </div>

  </div>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../usage/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                usage
              </div>
            </div>
          </a>
        
        
          <a href="../contributing/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                contributing
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
  <div class="md-footer-social">
    
      
      
      <a href="http://www.jieyu.ai" target="_blank" rel="noopener" title="Tweet" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
      </a>
    
      
      
      <a href="http://www.jieyu.ai" target="_blank" rel="noopener" title="Facebook" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"/></svg>
      </a>
    
      
      
      <a href="https://github.com/san-soucie/gdrf" target="_blank" rel="noopener" title="Github" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
      </a>
    
      
      
      <a href="mailto:jsansoucie@whoi.edu" target="_blank" rel="noopener" title="" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 8l-8 5-8-5V6l8 5 8-5m0-2H4c-1.11 0-2 .89-2 2v12a2 2 0 002 2h16a2 2 0 002-2V6a2 2 0 00-2-2z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.18f0862e.min.js"></script>
      <script src="../assets/javascripts/bundle.994580cf.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: ['navigation.indexes', 'navigation.tabs', 'navigation.instant', 'navigation.tabs.sticky'],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.9c0e82ba.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>